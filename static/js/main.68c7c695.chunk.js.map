{"version":3,"sources":["components/RichEditor/common/Defines.ts","components/RichEditor/comps/ListComp.ts","components/RichEditor/common/utils.ts","components/RichEditor/common/globalStore.ts","components/RichEditor/comps/Td.tsx","components/RichEditor/comps/Table.tsx","components/RichEditor/common/slateToHtml.ts","components/RichEditor/common/htmlToSlate.ts","components/RichEditor/comps/ToolBar.tsx","components/RichEditor/EventHandler/HandleKeyDownEvent/HandleKeyDownEvent.ts","components/RichEditor/EventHandler/HandleKeyDownEvent/handleSelectedTd.ts","components/RichEditor/EventHandler/HandleKeyDownEvent/handleRangeExpand.ts","components/RichEditor/EventHandler/HandleKeyDownEvent/handleRangeCollapsed.ts","components/RichEditor/c.jpg","components/RichEditor/comps/ImgComp.tsx","components/RichEditor/comps/LinkComp.tsx","components/RichEditor/RenderElements/MyElements.tsx","components/RichEditor/RenderElements/RenderLeaf.tsx","components/RichEditor/RichEditor.tsx","components/RichEditor/plugins/WithCyWrap.ts","index.tsx"],"names":["CET","Marks","TextWrappers","DIV","H1","H2","H3","H4","P","InLineTypes","IMG","LINK","ListLogic","toggleList","editor","type","Editor","nodes","mode","match","n","Text","isText","isInline","text","textWrapper","parent","twParent","li","isListItem","liParent","utils","getParent","isSameTypeToggle","Element","isElement","isChangeListType","isSetToList","Transforms","unwrapNodes","withoutNormalizing","parents","Set","selectedListItems","path","add","join","forEach","value","p","split","map","o","setNodes","at","hanging","Array","from","reverse","isTextWrapper","length","wrapNodes","LIST_ITEM","children","isOrderList","isInLi","selection","Range","isCollapsed","getFirstAboveElementType","node","includes","NUMBER_LIST","NORMAL_LIST","normalizeList","nodeEntry","Node","child","removeNodes","secChildPath","concat","liftNodes","colors","texts","Color","size","onlyColor","pop","liColor","prePath","getPath","getNodeByPath","preNode","mergeNodes","nextPath","nextNode","first","onlyChild","childP","childCount","tabEvent","universal","indentLi","liEntry","ReactEditor","findPath","shiftTabEvent","liftLi","liPath","pp","parentParent","encodeSlateContent","data","window","btoa","encodeURIComponent","JSON","stringify","decodeContentToSlateData","parse","decodeURIComponent","atob","removeRangeElement","tables","TableLogic","isTable","table","tableRange","range","inte","intersection","equals","lists","list","listRange","tRange","isInTd","isTd","Path","delete","unit","collapse","edge","anchor","element","isEditor","EDITOR","basePath","slice","t","error","this","globalStore","selectedTds","editingTdsPath","preSelectedTdPos","row","col","copyedCellsPath","copyedAreaHeight","copyedAreaWidth","copyedCells","copyedContent","setCopyedContent","setCopyedCells","getCopyedCells","setCopyedMaxRowAndCol","setPreSelectedTdPos","getStrPathSetOfSelectedTds","filterPath","setStrPathSetOfSelectedTds","paths","hasPath","getEditingTdsPath","setEditingTdsPath","editingTdPath","tdMinWidth","tdMinHeight","TD","attributes","useSlateStatic","readOnly","useReadOnly","useEffect","width","height","pathStr","editingTds","nowEdit","canTdEdit","nowSelected","selected","otherAttr","contentEditable","colSpan","rowSpan","style","minWidth","maxWidth","cursor","color","backgroundColor","BGColor","userSelect","textAlign","TextAlign","fontSize","FontSize","fontWeight","BOLD","fontStyle","ITALIC","textDecoration","Underline","LineThrough","onDoubleClick","e","stopPropagation","selfDom","ref","current","td","toSlateNode","tdPath","TdLogic","editTd","onMouseDown","target","className","finallyTd","clickDom","clickNode","clickNodePath","tdWrapper","above","chooseTd","position","right","top","x","clientX","cell","i","nativeEvent","ele","tagName","cellNode","cellPath","tbody","TBODY","tdMap","getTdMap","tdOriginRow","tdOriginCol","targetCol","j","originCol","originRow","cells","tdInMap","tdDom","toDOMNode","initX","offsetWidth","push","mouseMoveHandler","dx","c","document","addEventListener","mouseUpHandler","querySelectorAll","tr","rowIndex","cellIndex","parseInt","tdNode","removeEventListener","left","bottom","y","clientY","targetRow","initY","offsetHeight","preventDefault","dy","minHeight","maxHeight","deselectAllTd","topTd","start","select","trs","startPoins","fill","tds","colStart","findIndex","colEnd","rowStart","rowEnd","fillTd","getSelectedTdInTdMap","a","b","selectedTd","Map","helper","selectedTdMap","has","set","Math","min","max","getEditingTd","selectedTdsPath","getSelectedTdsPath","unsetNodes","findTargetTd","direct","some","startTd","rightX","targetTd","deselect","clearTd","getSelectedTds","Table","useRef","isBeginSelectTd","mouseDownStartPoint","lastSelectedPaths","preMouseOnTdPath","useContext","EditorContext","savedMarks","setSavedMarks","nowWrapperWidth","preWrapperWidth","wrapperWidthWhenCreated","tableDom","querySelector","tableNode","tablePath","reCalcTdWidth","resetSelectedTds","selectTd","_","debounce","pa","pb","commonNode","common","pbTd","paTd","deselectTds","TR","tda","tdb","nowTdsPath","keys","nowSelectedTds","preSelectedTds","nowSelectedTdsPathSet","preSelectedTdsPathSet","deselectedPath","filter","newSelectedPath","mousemoveFunc","abs","slateNode","point","mouseupFunc","onmousemove","onmousedown","onmouseup","display","overflowX","overflowY","border","tableLayout","wordBreak","borderCollapse","find","onMouseUp","copyMarks","hasSelectTd","getSelectedTdsSize","Object","values","key","getEditingOrSelectedTdBelongTable","getFirstSelectedTd","model","TABLE","item","fatherIndex","index","isSelectedTd","normalizeTable","shouldEmpty","string","voids","deleteRow","deleteVArea","Infinity","removePath","unshift","leftCol","moveNodes","to","deleteColumn","deleteHArea","sort","arow","brow","acol","bcol","insertColumn","count","nowTd","nowTr","insertCol","editorDom","getInsertCells","cloneDeep","nowTdRow","nowTdCol","tdInTdMap","Number","isFinite","downTd","downTdOriginPos","insertNodes","insertRow","insertNode","getInsertRow","tdCount","splitTd","belongTr","tdCol","tdRow","tdColSpan","tdRowSpan","leftSumColSpan","findInsertCol","sumColSpan","isInNowTr","insertTdCount","mergeTd","isOnlyOne","tbodyPath","firstTd","maxColSpan","maxRowSpan","newTdPath","firstTdEntry","toBeDeleted","deleteTable","insertDivAfterTable","insertDivBeforeTable","pathArr","tdArr","arr","getEditingTds","tdsPath","copyCells","areaWidth","areaHeight","pasteCells","startPoint","message","waitToDeleteTdsPath","uniqWith","minRow","reduce","nowCopyedCellsRow","insertTds","copyedTd","childLength","slateToHtml","padding","replace","toLocaleLowerCase","getStyle","escapeHtml","attrs","url","trim","getAttributes","deserialize","el","nodeType","textContent","nodeStyle","cssText","changeKey","$0","$1","$2","$3","toUpperCase","changeValue","childNodes","nodeName","jsx","every","Block","getAttribute","htmlToSlate","html","DOMParser","parseFromString","body","calcStatusDelay","isSelectTd","ColorPicker","props","useSlate","useState","setColor","visible","setVisible","_getColor","getColor","mark","marks","getComputedStyle","useMemo","title","zIndex","mouseLeaveDelay","mouseEnterDelay","onMouseLeave","placement","overlayStyle","overlay","onChange","trigger","getPopupContainer","triggerNode","parentElement","icon","ColorPickerCore","hex","justifyContent","flexDirection","DeleteOutlined","onClick","ValueSelector","setValue","toolDom","getValue","placeholder","bordered","open","dropdownClassName","onSelect","focus","afterSelect","options","Option","String","optionLabelRender","MarkButton","setType","getType","console","isMarkActive","removeMark","addMark","toggleMark","StaticButton","disabled","mousedownFunc","ReactButton","disabledCondition","setDisabled","_isDisabled","CopyFormat","isDisabled","isNotOnlyOne","warn","copyMark","FormatPainterOutlined","InsertTableButton","counts","setCounts","tdMouseEnter","parentNode","addTable","cellCount","rowCount","isInteger","tw","twDom","offsetParent","tableWrapperWidth","onMouseEnter","ReadOnlyButton","setReadOnly","ToolBar","setTextWrapper","marginBottom","align","getMarkValue","all","cleanFormat","Icon","component","viewBox","version","xmlns","p-id","d","FontColorsOutlined","BgColorsOutlined","BoldOutlined","ItalicOutlined","UnderlineOutlined","StrikethroughOutlined","OrderedListOutlined","UnorderedListOutlined","setLink","LinkOutlined","isExpanded","move","PictureOutlined","FolderOpenOutlined","TableOutlined","DeleteColumnOutlined","DeleteRowOutlined","VerticalAlignBottomOutlined","VerticalAlignTopOutlined","InsertRowLeftOutlined","InsertRowRightOutlined","InsertRowAboveOutlined","InsertRowBelowOutlined","MergeCellsOutlined","SplitCellsOutlined","ClearOutlined","log","localStorage","setItem","SaveOutlined","content","HandleKeyDownEvent","isNotOnlyOneTd","getFirstTd","shiftKey","ctrlKey","handleSelectedTd","handleRangeExpand","elementType","insertText","isStart","isEnd","handleRangeCollapsed","ImgComp","useSelected","showTool","state","setState","onclick","marginRight","marginLeft","verticalAlign","boxShadow","setTimeout","dataset","cyimgcomptool","testImg","enable","isReadOnly","topRight","bottomRight","bottomLeft","topLeft","onResizeStop","direction","newWidth","newHeight","alt","src","LinkComp","setContent","setUrl","formItemStyle","editPanel","gutter","flex","Item","label","SelectOutlined","DisconnectOutlined","justify","link","linkPath","href","innerText","initEditPanel","MyElements","MyLeaf","leaf","createContext","EditorComp","deleteForward","deleteBackward","deleteFragment","getFragment","insertFragment","insertData","insertBreak","isVoid","normalizeNode","apply","setFragmentData","redo","undo","after","nextTable","before","preTable","fragment","newTransfer","DataTransfer","setData","types","getData","afterList","next","beforeList","previous","isBlock","withCyWrap","withHistory","withReact","createEditor","getItem","preUndos","preSelection","renderElement","useCallback","editorRef","renderLeaf","MyToolBar","Provider","overflow","screen","availHeight","autoFocus","onCompositionStart","onKeyDown","onDragStart","onBlur","onFocus","hasTextAlign","ReactDOM","render","getElementById"],"mappings":"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","file":"static/js/main.68c7c695.chunk.js","sourcesContent":["import { BaseEditor } from \"slate\";\nimport { HistoryEditor } from \"slate-history\";\nimport { Editable, ReactEditor, Slate } from \"slate-react\";\n\nexport enum CET {\n  EDITOR = \"editor\",\n  NUMBER_LIST = \"ol\",\n  NORMAL_LIST = \"ul\",\n  LIST_ITEM = \"li\",\n  DIV = \"div\",\n  Block = \"block\",\n  P = \"p\",\n  H1 = \"h1\",\n  H2 = \"h2\",\n  H3 = \"h3\",\n  H4 = \"h4\",\n  IMG = \"img\",\n  LINK = \"link\",\n  TABLE = \"table\",\n  TBODY = \"tbody\",\n  TR = \"tr\",\n  TD = \"td\",\n}\n\nexport const TextWrappers = [CET.DIV, CET.H1, CET.H2, CET.H3, CET.H4, CET.P];\nexport const InLineTypes = [CET.IMG, CET.LINK];\n\nexport enum Marks {\n  BOLD = \"bold\",\n  ITALIC = \"italic\",\n  FontSize = \"fontSize\",\n  Underline = \"underline\",\n  LineThrough = \"line-through\",\n  Color = \"color\",\n  BGColor = \"backgroundColor\",\n  TextAlign = \"textAlign\",\n}\n\nexport type CustomElement = {\n  type: CET;\n  [key: string]: any;\n  url?: string; // 图片，Link组件的参数\n  colSpan?: number; // td属性\n  rowSpan?: number; // td 属性\n  width?: number; // td样式属性\n  height?: number; // td样式属性\n  selected?: boolean; // td是否被选中\n  canTdEdit?: boolean; // td是否可以编辑\n  liColor?: string; // li color\n  wrapperWidthWhenCreated?: number; // table创建时所在的容器宽度，用于动态计算td的宽度\n  textAlign?: \"left\" | \"right\" | \"center\"; // textWrapper的属性\n  tdMap?: any; // 用于计算tdMap\n  children: (CustomText | CustomElement)[];\n};\nexport type CustomText = { text: string; [key: string]: any } & Partial<\n  {\n    [key in Marks]: any;\n  }\n>;\nexport type EditorType = BaseEditor & ReactEditor & HistoryEditor;\n\nexport type StateShape = Parameters<typeof Slate>[0][\"value\"];\nexport type EditorCompPropShape = {};\nexport type EditorCompShape = (\n  props: EditorCompPropShape\n) => React.ReactElement;\nexport type EditableProps = Parameters<typeof Editable>[0];\n","/* eslint-disable eqeqeq */\nimport {\n  Transforms,\n  Range,\n  Text,\n  Element,\n  Editor,\n  Node,\n  NodeEntry,\n} from \"slate\";\nimport { ReactEditor } from \"slate-react\";\nimport { CET, EditorType, Marks } from \"../common/Defines\";\nimport { utils } from \"../common/utils\";\n\nexport const ListLogic = {\n  toggleList(editor: EditorType, type: CET.NORMAL_LIST | CET.NUMBER_LIST) {\n    // 判断当前是不是列表形态\n    const [text] = Editor.nodes(editor, {\n      mode: \"lowest\",\n      match(n) {\n        return Text.isText(n) || Editor.isInline(editor, n);\n      },\n    });\n    if (!text) return;\n    const textWrapper = Editor.parent(editor, text[1]);\n    if (!textWrapper) return;\n    const twParent = Editor.parent(editor, textWrapper[1]);\n    const li = ListLogic.isListItem(twParent[0]) && twParent;\n    const liParent = li && utils.getParent(editor, li[1]);\n\n    const isSameTypeToggle =\n      li &&\n      liParent &&\n      Element.isElement(liParent[0]) &&\n      liParent?.[0].type == type;\n    // 是否改变列表类型\n    const isChangeListType = li && !isSameTypeToggle;\n    // 是否删除列表\n    const isCancelList = li && isSameTypeToggle;\n    // 是否设置为列表\n    const isSetToList = !li;\n\n    const cancelList = () => {\n      Transforms.unwrapNodes(editor, {\n        match(n) {\n          return ListLogic.isListItem(n);\n        },\n      });\n    };\n\n    const changeListType = () => {\n      Editor.withoutNormalizing(editor, () => {\n        const parents = new Set<string>();\n        const selectedListItems = Editor.nodes(editor, {\n          mode: \"lowest\",\n          match(n) {\n            return ListLogic.isListItem(n);\n          },\n        });\n        for (const [, path] of selectedListItems) {\n          const parent = utils.getParent(editor, path);\n          parent[0] != null && parents.add(parent[1].join(\"-\"));\n        }\n        parents.forEach((value) => {\n          const p = value.split(\"-\").map((o) => +o);\n          Transforms.setNodes(\n            editor,\n            {\n              type,\n            },\n            {\n              at: p,\n              hanging: true,\n            }\n          );\n        });\n      });\n    };\n\n    const setList = () => {\n      Editor.withoutNormalizing(editor, () => {\n        const elementsInRange = Array.from(\n          Editor.nodes(editor, {\n            reverse: true,\n            mode: \"lowest\",\n            match(n) {\n              return utils.isTextWrapper(n);\n            },\n          })\n        );\n\n        for (const [, path] of elementsInRange) {\n          if (path.length == 0) continue;\n          const [parent] = utils.getParent(editor, path);\n          if (ListLogic.isListItem(parent)) continue;\n          Transforms.wrapNodes(\n            editor,\n            {\n              type: CET.LIST_ITEM,\n              children: [],\n            },\n            { at: path }\n          );\n          if (!ListLogic.isOrderList(parent)) {\n            Transforms.wrapNodes(\n              editor,\n              {\n                type,\n                children: [],\n              },\n              { at: path }\n            );\n          }\n        }\n      });\n    };\n\n    if (isCancelList) {\n      cancelList();\n    } else if (isChangeListType) {\n      changeListType();\n    } else if (isSetToList) {\n      setList();\n    }\n  },\n  isInLi(editor: EditorType) {\n    if (editor.selection && Range.isCollapsed(editor.selection)) {\n      return utils.getFirstAboveElementType(editor) == CET.LIST_ITEM;\n    }\n    return false;\n  },\n  isListItem(node: Node): node is Element {\n    return Element.isElement(node) && [CET.LIST_ITEM].includes(node.type);\n  },\n  isOrderList(node: Node | null | undefined): node is Element {\n    return (\n      Element.isElement(node) &&\n      [CET.NUMBER_LIST, CET.NORMAL_LIST].includes(node.type)\n    );\n  },\n  normalizeList(editor: EditorType, nodeEntry: NodeEntry) {\n    const [node, path] = nodeEntry;\n\n    if (ListLogic.isListItem(node)) {\n      const parent = utils.getParent(editor, path);\n      /**\n       * 如果父节点为空\n       * 或者\n       * 不为列表元素或者子元素为空，\n       * 或者\n       * 子元素只有一个文本节点(且本身在本编辑器中也是不合法的，只不过slate会默认给block元素加入一个默认的空文本节点)\n       *\n       */\n      if (parent.length == 0 || !ListLogic.isOrderList(parent[0])) {\n        Transforms.unwrapNodes(editor, { at: path });\n        return true;\n      }\n\n      if (\n        node.children.length == 0 ||\n        (node.children.length == 1 && Text.isText(Node.child(node, 0)))\n      ) {\n        Transforms.removeNodes(editor, { at: path });\n        return true;\n      }\n\n      if (node.children.length > 1) {\n        const secChildPath = path.concat([1]);\n        Transforms.wrapNodes(\n          editor,\n          { type: CET.LIST_ITEM, children: [] },\n          { at: secChildPath }\n        );\n        Transforms.liftNodes(editor, { at: secChildPath });\n        return true;\n      }\n\n      // 如果所有的text都是一样的Color，那么设置li的color也为该color\n      const colors = new Set();\n      for (const [child] of Node.texts(node)) {\n        colors.add(child[Marks.Color]);\n      }\n      if (colors.size == 1) {\n        const onlyColor = Array.from(colors).pop();\n        onlyColor &&\n          Transforms.setNodes(editor, { liColor: onlyColor }, { at: path });\n        return;\n      }\n    }\n\n    if (ListLogic.isOrderList(node)) {\n      // 如果自己跟前一个节点都是列表节点，那么将前一个改成和自己一样\n      const prePath = utils.getPath(path, \"pre\");\n      const [preNode] = utils.getNodeByPath(editor, prePath);\n\n      if (ListLogic.isOrderList(preNode) && preNode.type != node.type) {\n        Transforms.setNodes(editor, { type: node.type }, { at: prePath });\n        return true;\n      }\n\n      // 合并前一个相同的列表元素\n      if (ListLogic.isOrderList(preNode) && preNode.type == node.type) {\n        Transforms.mergeNodes(editor, { at: path });\n        return true;\n      }\n\n      const nextPath = utils.getPath(path, \"next\");\n      const [nextNode] = utils.getNodeByPath(editor, nextPath);\n\n      // 如果自己跟后一个节点都是列表节点，那么将自己的类型改成和它一样\n      if (ListLogic.isOrderList(nextNode) && nextNode.type != node.type) {\n        Transforms.setNodes(editor, { type: nextNode.type }, { at: nextPath });\n        return true;\n      }\n\n      // 合并后一个相同的列表元素\n      if (ListLogic.isOrderList(nextNode) && nextNode.type == node.type) {\n        Transforms.mergeNodes(editor, { at: nextPath });\n        return true;\n      }\n\n      // 如果只有一个列表子节点，那么将自己变成和子节点一样的类型\n      if (node.children.length == 1) {\n        const [onlyChild] = Node.first(node, [0]);\n        if (ListLogic.isOrderList(onlyChild) && onlyChild.type != node.type) {\n          Transforms.setNodes(editor, { type: onlyChild.type }, { at: path });\n          return true;\n        }\n      }\n\n      for (const [child, childP] of Node.children(editor, path, {\n        reverse: true,\n      })) {\n        // 如果不为li元素，则提升\n        if (!ListLogic.isListItem(child) && !ListLogic.isOrderList(child)) {\n          Transforms.liftNodes(editor, { at: childP });\n          return true;\n        }\n      }\n\n      // 如果没有符合条件的子元素，那么删除此列表元素\n      let childCount = 0; // li,ul,ol数量\n      for (const [child] of Node.children(editor, path, {\n        reverse: true,\n      })) {\n        if (ListLogic.isOrderList(child) || ListLogic.isListItem(child)) {\n          childCount++;\n        }\n      }\n      if (childCount == 0) {\n        Transforms.removeNodes(editor, { at: path });\n        return true;\n      }\n    }\n    return false;\n  },\n  tabEvent(editor: EditorType) {\n    Editor.withoutNormalizing(editor, () => {\n      const selectedListItems = Editor.nodes(editor, {\n        universal: true,\n        mode: \"lowest\",\n        match(n) {\n          return ListLogic.isListItem(n);\n        },\n      });\n\n      for (const [n, p] of selectedListItems) {\n        ListLogic.indentLi(editor, [n, p]);\n      }\n    });\n  },\n  indentLi(editor: EditorType, liEntry: NodeEntry) {\n    Editor.withoutNormalizing(editor, () => {\n      const [li] = liEntry;\n      const p = ReactEditor.findPath(editor, li);\n\n      const nextNode = utils.getNodeByPath(editor, utils.getPath(p, \"next\"));\n      const parent = utils.getParent(editor, p);\n      if (nextNode.length > 0 && ListLogic.isOrderList(nextNode?.[0])) {\n        Transforms.wrapNodes(\n          editor,\n          {\n            type: nextNode[0].type,\n            children: [],\n          },\n          { at: p }\n        );\n      } else if (parent.length > 0 && ListLogic.isOrderList(parent?.[0])) {\n        Transforms.wrapNodes(\n          editor,\n          {\n            type: parent[0].type,\n            children: [],\n          },\n          { at: p }\n        );\n      }\n    });\n  },\n  shiftTabEvent(editor: EditorType) {\n    Editor.withoutNormalizing(editor, () => {\n      const selectedListItems = Editor.nodes(editor, {\n        universal: true,\n        reverse: true,\n        mode: \"lowest\",\n        match(n) {\n          return ListLogic.isListItem(n);\n        },\n      });\n\n      for (const [n, p] of selectedListItems) {\n        ListLogic.liftLi(editor, [n, p]);\n      }\n    });\n  },\n  liftLi(editor: EditorType, liEntry: NodeEntry) {\n    const [, liPath] = liEntry;\n    const [parent, pp] = utils.getParent(editor, liPath);\n    const [parentParent] = parent && utils.getParent(editor, pp);\n\n    if (ListLogic.isOrderList(parentParent)) {\n      Transforms.liftNodes(editor, {\n        at: liPath,\n      });\n    }\n  },\n};\n","/* eslint-disable eqeqeq */\nimport {\n  Element,\n  Editor,\n  Path,\n  Text,\n  Node,\n  Transforms,\n  Range,\n  Descendant,\n} from \"slate\";\nimport { TextWrappers, EditorType, CET } from \"./Defines\";\nimport { TableLogic } from \"../comps/Table\";\nimport { jsx } from \"slate-hyperscript\";\nimport { ListLogic } from \"../comps/ListComp\";\n\nconst deserialize: any = (el: any) => {\n  // text node\n  if (el.nodeType === 3) {\n    return el.textContent;\n    // not element node\n  } else if (el.nodeType !== 1) {\n    return null;\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  let children = Array.from(el.childNodes).map(deserialize);\n\n  if (children.length === 0) {\n    children = [{ text: \"\" }];\n  }\n\n  switch (el.nodeName) {\n    case \"BODY\":\n      return jsx(\"fragment\", {}, children);\n    case \"BR\":\n      return \"\\n\";\n    case \"BLOCKQUOTE\":\n      return jsx(\"element\", { type: \"quote\" }, children);\n    case \"P\":\n    case \"DIV\":\n      return jsx(\"element\", { type: CET.DIV }, children);\n    case \"A\":\n      return jsx(\n        \"element\",\n        {\n          type: CET.LINK,\n          url: el.getAttribute(\"href\"),\n          content: el.innserHTML,\n        },\n        children\n      );\n    case \"IMG\":\n      return jsx(\n        \"element\",\n        {\n          type: CET.IMG,\n          url: el.getAttribute(\"src\"),\n        },\n        children\n      );\n    case \"TABLE\":\n      return jsx(\n        \"element\",\n        {\n          type: CET.TABLE,\n        },\n        children\n      );\n    case \"TBODY\":\n      return jsx(\n        \"element\",\n        {\n          type: CET.TBODY,\n        },\n        children\n      );\n    case \"TR\":\n      return jsx(\n        \"element\",\n        {\n          type: CET.TR,\n        },\n        children\n      );\n    case \"TD\":\n      return jsx(\n        \"element\",\n        {\n          type: CET.TD,\n          colSpan: el.getAttribute(\"colSpan\"),\n        },\n        children\n      );\n    default:\n      return el.textContent;\n  }\n};\n\n/**\n * const html = '...'\nconst document = new DOMParser().parseFromString(html, 'text/html')\ndeserialize(document.body)\n */\n\nexport const utils = {\n  encodeSlateContent(data: Descendant[]) {\n    return window?.btoa(encodeURIComponent(JSON.stringify(data)));\n  },\n  decodeContentToSlateData(data: string) {\n    return JSON.parse(decodeURIComponent(window.atob(data)));\n  },\n  removeRangeElement(editor: EditorType) {\n    const { selection } = editor;\n    if (!selection) return;\n    if (Range.isCollapsed(selection)) return;\n\n    // 如果全选了表格，那么直接删除表格\n    const tables = Editor.nodes(editor, {\n      at: selection,\n      match(n) {\n        return TableLogic.isTable(n);\n      },\n    });\n    for (const table of tables) {\n      if (table) {\n        const tableRange = Editor.range(editor, table[1]);\n        const inte = Range.intersection(selection, tableRange);\n        if (inte && Range.equals(tableRange, inte)) {\n          Transforms.removeNodes(editor, { at: table[1] });\n          utils.removeRangeElement(editor);\n          return;\n        }\n      }\n    }\n\n    // 如果全选了列表，那么直接删除列表即可\n    const lists = Editor.nodes(editor, {\n      at: selection,\n      match(n) {\n        return ListLogic.isOrderList(n);\n      },\n    });\n    for (const list of lists) {\n      if (!!list) {\n        const listRange = Editor.range(editor, list[1]);\n        const inte = Range.intersection(selection, listRange);\n        if (inte && Range.equals(listRange, inte)) {\n          Transforms.removeNodes(editor, { at: list[1] });\n          utils.removeRangeElement(editor);\n          return;\n        }\n      }\n    }\n\n    // 部分删除，此部分最耗费性能，因为考虑到列表和表格可能杂糅在一起，所以需要从textWrapper一个个处理\n    const texts = Array.from(\n      Editor.nodes(editor, {\n        reverse: true,\n        match(n, p) {\n          return Text.isText(n) || Editor.isInline(editor, n);\n        },\n      })\n    );\n    for (const [, p] of texts) {\n      const textWrapper = utils.getParent(editor, p);\n      if (textWrapper.length > 0 && utils.isTextWrapper(textWrapper[0])) {\n        const tRange = Editor.range(editor, textWrapper[1]);\n        const inte =\n          editor.selection && Range.intersection(editor.selection, tRange);\n        if (!inte) continue;\n        const [twParent] = utils.getParent(editor, textWrapper[1]);\n        const isInTd = TableLogic.isTd(twParent);\n        // 如果整个被包含，那么直接删除textWrapper\n        if (\n          Range.equals(inte, tRange) &&\n          !(isInTd && twParent.children.length == 1) &&\n          !Path.equals(texts[0][1], p)\n        ) {\n          Transforms.removeNodes(editor, {\n            at: textWrapper[1],\n          });\n        } else {\n          if (Range.isCollapsed(inte)) continue;\n          Transforms.delete(editor, {\n            at: inte,\n            reverse: true,\n            unit: \"character\",\n            hanging: true,\n          });\n        }\n      }\n    }\n\n    Transforms.collapse(editor, { edge: \"start\" });\n  },\n  isTextWrapper(node: Node) {\n    return Element.isElement(node) && TextWrappers.includes(node.type);\n  },\n  // 获取包裹光标文本位置的li或者td\n  getFirstAboveElementType(editor: EditorType) {\n    if (editor.selection) {\n      const textWrapper = utils.getParent(editor, editor.selection.anchor.path);\n      if (!textWrapper[0]) return null;\n      const element = utils.getParent(editor, textWrapper[1]);\n      if (!element[0]) return null;\n\n      return (\n        (Element.isElement(element[0]) && element[0].type) ||\n        (Editor.isEditor(element[0]) && CET.EDITOR)\n      );\n    }\n  },\n  getPath(path: Path, type: \"pre\" | \"next\" | \"parent\") {\n    const basePath = path.slice(0, path.length - 1);\n    const t = path[path.length - 1];\n    return type == \"parent\"\n      ? basePath\n      : [...basePath, type == \"pre\" ? t - 1 : t + 1];\n  },\n  getNodeByPath(editor: EditorType, path: Path) {\n    try {\n      return Editor.node(editor, path);\n    } catch (error) {\n      return [];\n    }\n  },\n  getParent(editor: EditorType, path: Path) {\n    return this.getNodeByPath(editor, this.getPath(path, \"parent\"));\n  },\n};\n","import { Descendant, Editor, NodeEntry, Path } from \"slate\";\nimport { EditorType } from \"./Defines\";\n\ntype preSelectedTdPosShape = {\n  row: number;\n  col: number;\n} | null;\n\ntype globalStoreShape = {\n  selectedTds: Set<string>;\n  editingTdsPath: Set<string>;\n  preSelectedTdPos: preSelectedTdPosShape;\n  copyedCellsPath: Path[] | null;\n  copyedAreaHeight: number; // 复制的区域的高度\n  copyedAreaWidth: number; // 复制的区域的宽度\n  copyedCells: NodeEntry[] | null;\n  copyedContent: Descendant[] | null;\n};\nconst globalStore: globalStoreShape = {\n  selectedTds: new Set<string>(),\n  editingTdsPath: new Set<string>(),\n  preSelectedTdPos: {\n    row: 0,\n    col: 0,\n  },\n  copyedCellsPath: null,\n  copyedAreaHeight: 0,\n  copyedAreaWidth: 0,\n  copyedCells: null,\n  copyedContent: null,\n};\n\nexport const getCopyedContent = () => {\n  return globalStore.copyedContent;\n};\n\nexport const setCopyedContent = (value: globalStoreShape[\"copyedContent\"]) => {\n  globalStore.copyedContent = value;\n};\n\nexport const setCopyedCells = (value: globalStoreShape[\"copyedCells\"]) => {\n  globalStore.copyedCells = value;\n};\n\nexport const getCopyedCells = () => {\n  return globalStore.copyedCells;\n};\n\nexport const getCopyedMaxRowAndCol = () => {\n  return {\n    copyedAreaHeight: globalStore.copyedAreaHeight,\n    copyedAreaWidth: globalStore.copyedAreaWidth,\n  };\n};\n\nexport const setCopyedMaxRowAndCol = (value: {\n  copyedAreaHeight: globalStoreShape[\"copyedAreaHeight\"];\n  copyedAreaWidth: globalStoreShape[\"copyedAreaWidth\"];\n}) => {\n  globalStore.copyedAreaHeight = value.copyedAreaHeight;\n  globalStore.copyedAreaWidth = value.copyedAreaWidth;\n};\n\nexport const setCopyedCellsPath = (\n  value: globalStoreShape[\"copyedCellsPath\"]\n) => {\n  globalStore.copyedCellsPath = value;\n};\n\nexport const getCopyedCellsPath = () => {\n  return globalStore.copyedCellsPath;\n};\n\nexport const getPreSelectedTdPos = () => {\n  return globalStore.preSelectedTdPos;\n};\n\nexport const setPreSelectedTdPos = (value: preSelectedTdPosShape) => {\n  globalStore.preSelectedTdPos = value;\n};\n\nexport const getStrPathSetOfSelectedTds = (editor: EditorType) => {\n  filterPath(editor, globalStore.selectedTds);\n  return globalStore.selectedTds;\n};\n\nexport const setStrPathSetOfSelectedTds = (\n  selectedTds: globalStoreShape[\"selectedTds\"]\n) => {\n  globalStore.selectedTds = selectedTds;\n};\n\nconst filterPath = (editor: EditorType, paths: Set<string>): void => {\n  for (const p of paths) {\n    const path = p.split(\",\").map((o) => +o);\n    if (!Editor.hasPath(editor, path)) {\n      paths.delete(p);\n      filterPath(editor, paths);\n      return;\n    }\n  }\n};\n\nexport const getEditingTdsPath = (editor: EditorType) => {\n  filterPath(editor, globalStore.editingTdsPath);\n  return globalStore.editingTdsPath;\n};\n\nexport const setEditingTdsPath = (\n  editingTdPath: globalStoreShape[\"editingTdsPath\"]\n) => {\n  globalStore.editingTdsPath = editingTdPath;\n};\n","/* eslint-disable eqeqeq */\nimport { useEffect } from \"react\";\nimport { Editor, Node, Element, Transforms, Path, NodeEntry } from \"slate\";\nimport {\n  ReactEditor,\n  RenderElementProps,\n  useReadOnly,\n  useSlateStatic,\n} from \"slate-react\";\nimport { CET, CustomElement, EditorType, Marks } from \"../common/Defines\";\nimport {\n  getEditingTdsPath,\n  getPreSelectedTdPos,\n  getStrPathSetOfSelectedTds,\n  setEditingTdsPath,\n  setPreSelectedTdPos,\n  setStrPathSetOfSelectedTds,\n} from \"../common/globalStore\";\nimport { TableLogic } from \"./Table\";\n\nexport type customTdShape = {\n  start: boolean;\n  colSpan: number;\n  rowSpan: number;\n  row: number; // 在tdMap里的坐标\n  col: number; // 在tdMap里的坐标\n  originRow: number; // 在原来tbody里的坐标\n  originCol: number; // 在原来tbody里的坐标\n} & CustomElement;\n\ntype tdMapShape = Array<customTdShape[]>;\ntype getTdMapReturn = {\n  tdMap: tdMapShape;\n  startPoins: customTdShape[];\n};\n\nexport let tdMinWidth = 100;\nexport const tdMinHeight = 30;\n\nexport const TD: (props: RenderElementProps) => JSX.Element = ({\n  attributes,\n  element,\n  children,\n}) => {\n  const editor = useSlateStatic();\n  const readOnly = useReadOnly();\n\n  useEffect(() => {\n    const path = ReactEditor.findPath(editor, element);\n    if (element.width == null || element.height == null) {\n      Transforms.setNodes(\n        editor,\n        {\n          width: element.width || tdMinWidth,\n          height: element.height || tdMinHeight,\n        },\n        {\n          at: path,\n        }\n      );\n    }\n    // 销毁时，删除状态\n    return () => {\n      const path = ReactEditor.findPath(editor, element);\n      const pathStr = path.join(\",\");\n      const selectedTds = getStrPathSetOfSelectedTds(editor);\n      const editingTds = getEditingTdsPath(editor);\n      selectedTds.delete(pathStr);\n      editingTds.delete(pathStr);\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  useEffect(() => {\n    const path = ReactEditor.findPath(editor, element);\n    const pathStr = path.join(\",\");\n    const selectedTds = getStrPathSetOfSelectedTds(editor);\n    const editingTds = getEditingTdsPath(editor);\n    const { canTdEdit: nowEdit, selected: nowSelected } = element;\n\n    if (nowEdit === true) {\n      editingTds.add(pathStr);\n    } else {\n      editingTds.delete(pathStr);\n    }\n\n    if (nowSelected === true) {\n      selectedTds.add(pathStr);\n    } else {\n      selectedTds.delete(pathStr);\n    }\n  });\n\n  const tdMouseDown = (e: any) => {\n    if ([\"resizer\", \"columnSelector\"].includes(e.target.className) || readOnly)\n      return;\n    const selfDom = attributes.ref.current;\n    if (!selfDom) return;\n\n    const td = ReactEditor.toSlateNode(editor, selfDom);\n    const tdPath = ReactEditor.findPath(editor, td);\n\n    // 如果点击自己的时候，自己还是处于编辑状态，那么退出\n    if (Element.isElement(td) && td.canTdEdit) return;\n\n    const clickDom = e.target;\n    const clickNode = ReactEditor.toSlateNode(editor, clickDom);\n    const clickNodePath = ReactEditor.findPath(editor, clickNode);\n    const isClickSelf = Path.equals(clickNodePath, tdPath);\n\n    let finallyTd: NodeEntry;\n    if (isClickSelf) {\n      finallyTd = [clickNode, clickNodePath];\n    } else {\n      const tdWrapper = Editor.above(editor, {\n        at: clickNodePath,\n        mode: \"lowest\",\n        match(n) {\n          return TableLogic.isTd(n);\n        },\n      });\n      if (!tdWrapper) return;\n      finallyTd = tdWrapper;\n    }\n    if (!finallyTd) return;\n    TdLogic.chooseTd(editor, finallyTd);\n  };\n  const tdDBClick = (e: any) => {\n    // 防止事件冒泡到父元素的td\n    e.stopPropagation();\n    const selfDom = attributes.ref.current;\n    if (!selfDom) return;\n\n    const td = ReactEditor.toSlateNode(editor, selfDom);\n    const tdPath = ReactEditor.findPath(editor, td);\n\n    TdLogic.editTd(editor, [td, tdPath]);\n  };\n  const resizeTdX = (e: any) => {\n    let x = e.clientX;\n    let cell: any = null,\n      table: any = null;\n\n    for (let i = 0, paths = e.nativeEvent.path; i < paths.length; i++) {\n      const ele = paths[i];\n      if (ele.tagName == \"TD\") {\n        cell = ele;\n      }\n      if (ele.tagName == \"TABLE\") {\n        table = ele;\n        break;\n      }\n    }\n\n    if (cell == null || table == null) return;\n\n    const cellNode = ReactEditor.toSlateNode(editor, cell);\n    const cellPath = ReactEditor.findPath(editor, cellNode);\n    const tbody = Editor.above(editor, {\n      at: cellPath,\n      match(n) {\n        return Element.isElement(n) && n.type == CET.TBODY;\n      },\n    });\n    if (!tbody) return;\n\n    // 找到tdMap中在当前cell的最右边的cells\n    const { tdMap } = TdLogic.getTdMap(tbody);\n    // 先找到当前的cell在tdMap中的位置\n    const [tdOriginRow, tdOriginCol] = cellPath.slice(cellPath.length - 2);\n    let targetCol: number = -1;\n    for (let i = 0; i < tdMap.length; i++) {\n      for (let j = 0; j < tdMap[i].length; j++) {\n        const td = tdMap[i][j];\n        if (td.originCol == tdOriginCol && td.originRow == tdOriginRow) {\n          targetCol = td.col + td.colSpan - 1;\n          break;\n        }\n      }\n      if (targetCol != -1) break;\n    }\n    if (targetCol == -1) return;\n\n    const cells: any[] = [];\n    for (let i = 0; i < tdMap.length; i++) {\n      const tdInMap = tdMap[i][targetCol];\n      const td = Editor.node(editor, [\n        ...tbody[1],\n        tdInMap.originRow,\n        tdInMap.originCol,\n      ]);\n      const tdDom: any = ReactEditor.toDOMNode(editor, td[0]);\n      tdDom.initX = tdDom.offsetWidth;\n      cells.push(tdDom);\n    }\n\n    // const tableInitWidth = table.offsetWidth;\n\n    const mouseMoveHandler = function (e: any) {\n      const dx = e.clientX - x;\n      cells.forEach((c) => {\n        c.style.maxWidth =\n          c.style.width =\n          c.style.minWidth =\n            (c.initX + dx < tdMinWidth ? tdMinWidth : c.initX + dx) + \"px\";\n      });\n      // table.style.width = tableInitWidth + dx + \"px\";\n    };\n\n    const mouseUpHandler = function () {\n      const trs = Array.from(table.querySelectorAll(\":scope>tbody>tr\"));\n      trs.forEach((tr: any, rowIndex) => {\n        const tds = Array.from(tr.querySelectorAll(\":scope>td\"));\n        tds.forEach((td: any, cellIndex) => {\n          const width = parseInt(td.style.minWidth);\n          const tdNode = ReactEditor.toSlateNode(editor, td);\n          if (Element.isElement(tdNode) && tdNode.width != width) {\n            Transforms.setNodes(\n              editor,\n              { width },\n              { at: [...tbody[1], rowIndex, cellIndex] }\n            );\n          }\n        });\n      });\n      document.removeEventListener(\"mousemove\", mouseMoveHandler);\n      document.removeEventListener(\"mouseup\", mouseUpHandler);\n    };\n\n    document.addEventListener(\"mousemove\", mouseMoveHandler);\n    document.addEventListener(\"mouseup\", mouseUpHandler);\n  };\n\n  const resizeTdY = (e: any) => {\n    let y = e.clientY;\n    let cell: any = null,\n      row: any = null,\n      table: any = null;\n\n    for (let i = 0, paths = e.nativeEvent.path; i < paths.length; i++) {\n      const ele = paths[i];\n      if (ele.tagName == \"TD\") {\n        cell = ele;\n      }\n      if (ele.tagName == \"TR\") {\n        row = ele;\n      }\n      if (ele.tagName == \"TABLE\") {\n        table = ele;\n        break;\n      }\n    }\n\n    if (cell == null || row == null || table == null) return;\n\n    const cellNode = ReactEditor.toSlateNode(editor, cell);\n    const cellPath = ReactEditor.findPath(editor, cellNode);\n    const tbody = Editor.above(editor, {\n      at: cellPath,\n      match(n) {\n        return Element.isElement(n) && n.type == CET.TBODY;\n      },\n    });\n    if (!tbody) return;\n\n    // 找到tdMap中在当前cell的最右边的cells\n    const { tdMap } = TdLogic.getTdMap(tbody);\n\n    // 先找到当前的cell在tdMap中的位置\n    const [tdOriginRow, tdOriginCol] = cellPath.slice(cellPath.length - 2);\n    let targetRow: number = -1;\n    for (let i = 0; i < tdMap.length; i++) {\n      for (let j = 0; j < tdMap[i].length; j++) {\n        const td = tdMap[i][j];\n        if (td.originCol == tdOriginCol && td.originRow == tdOriginRow) {\n          targetRow = td.row + td.rowSpan - 1;\n          break;\n        }\n      }\n      if (targetRow != -1) break;\n    }\n    if (targetRow == -1) return;\n\n    const cells: any[] = [];\n    for (let i = 0; i < tdMap[0].length; i++) {\n      const tdInMap = tdMap[targetRow][i];\n      const td = Editor.node(editor, [\n        ...tbody[1],\n        tdInMap.originRow,\n        tdInMap.originCol,\n      ]);\n      const tdDom: any = ReactEditor.toDOMNode(editor, td[0]);\n      tdDom.initY = tdDom.offsetHeight;\n      cells.push(tdDom);\n    }\n\n    // const tableInitY = parseInt(window.getComputedStyle(table).minHeight);\n\n    const mouseMoveHandler = function (e: any) {\n      e.preventDefault();\n      const dy = e.clientY - y;\n      cells.forEach(\n        (c) =>\n          (c.style.minHeight =\n            c.style.height =\n            c.style.maxHeight =\n              (c.initY + dy <= tdMinHeight ? tdMinHeight : c.initY + dy) + \"px\")\n      );\n      // table.style.height = tableInitY + dy + \"px\";\n    };\n\n    const mouseUpHandler = function () {\n      const trs = Array.from(table.querySelectorAll(\":scope>tbody>tr\"));\n      trs.forEach((tr: any, rowIndex) => {\n        const tds = Array.from(tr.querySelectorAll(\":scope>td\"));\n        tds.forEach((td: any, cellIndex) => {\n          const height = parseInt(td.style.height);\n          const tdNode = ReactEditor.toSlateNode(editor, td);\n          if (Element.isElement(tdNode) && tdNode.height != height) {\n            Transforms.setNodes(\n              editor,\n              { height },\n              { at: [...tbody[1], rowIndex, cellIndex] }\n            );\n          }\n        });\n      });\n      document.removeEventListener(\"mousemove\", mouseMoveHandler);\n      document.removeEventListener(\"mouseup\", mouseUpHandler);\n    };\n\n    document.addEventListener(\"mousemove\", mouseMoveHandler);\n    document.addEventListener(\"mouseup\", mouseUpHandler);\n  };\n  const otherAttr: any = {\n    contentEditable: false,\n  };\n  if (element.canTdEdit === true) {\n    delete otherAttr.contentEditable;\n  }\n\n  return (\n    <td\n      {...attributes}\n      colSpan={element.colSpan}\n      rowSpan={element.rowSpan}\n      style={{\n        minWidth: element.width || tdMinWidth,\n        maxWidth: element.width || tdMinWidth,\n        width: element.width || tdMinWidth,\n        height: element.height || tdMinHeight,\n        cursor: element.canTdEdit || readOnly ? \"inherit\" : \"cell\",\n        color: element[Marks.Color] || \"unset\",\n        backgroundColor:\n          element.selected && !readOnly\n            ? \"rgba(180,215,255,.7)\"\n            : element[Marks.BGColor] || \"unset\",\n        userSelect: element.canTdEdit || readOnly ? \"unset\" : \"none\",\n        textAlign: element[Marks.TextAlign] || \"unset\",\n        fontSize: element[Marks.FontSize] || \"unset\",\n        fontWeight: element[Marks.BOLD] ? \"bold\" : \"unset\",\n        fontStyle: element[Marks.ITALIC] ? \"italic\" : \"unset\",\n        textDecoration: `${element[Marks.Underline] ? \"underline\" : \"\"} ${\n          element[Marks.LineThrough] ? \"line-through\" : \"\"\n        }`,\n      }}\n      {...otherAttr}\n      onDoubleClick={tdDBClick}\n      onMouseDown={tdMouseDown}\n    >\n      {children}\n      {!readOnly ? (\n        <>\n          <span\n            className=\"resizer\"\n            style={{\n              position: \"absolute\",\n              width: 5,\n              right: 0,\n              top: 0,\n              height: \"100%\",\n              cursor: \"col-resize\",\n              userSelect: \"none\",\n            }}\n            contentEditable={false}\n            onMouseDown={resizeTdX}\n          ></span>\n          <span\n            className=\"resizer\"\n            style={{\n              position: \"absolute\",\n              width: \"100%\",\n              height: 5,\n              left: 0,\n              bottom: 0,\n              cursor: \"row-resize\",\n              userSelect: \"none\",\n            }}\n            contentEditable={false}\n            onMouseDown={resizeTdY}\n          ></span>\n        </>\n      ) : null}\n    </td>\n  );\n};\n\nexport const TdLogic = {\n  editTd(editor: EditorType, td: NodeEntry) {\n    TdLogic.deselectAllTd(editor);\n\n    // 获取最顶层td\n    const topTd = Editor.above(editor, {\n      at: td[1],\n      mode: \"highest\",\n      match(n) {\n        return TableLogic.isTd(n);\n      },\n    });\n\n    Transforms.setNodes(\n      editor,\n      { canTdEdit: true, start: true },\n      {\n        at: Editor.range(editor, topTd ? topTd[1] : td[1]),\n        mode: \"all\",\n        hanging: true,\n        match(n) {\n          return TableLogic.isTd(n);\n        },\n      }\n    );\n    Transforms.select(editor, td[1]);\n\n    setPreSelectedTdPos({\n      row: td[1][td[1].length - 2],\n      col: td[1][td[1].length - 1],\n    });\n  },\n  getTdMap(tbody: NodeEntry): getTdMapReturn {\n    const trs = tbody[0].children as Element[];\n    const startPoins: customTdShape[] = [];\n    const tdMap: any = new Array(trs.length).fill(0).map(() => []);\n    for (let i = 0; i < trs.length; i++) {\n      const tr = trs[i];\n      const tds = tr.children;\n      for (let j = 0; j < tds.length; j++) {\n        const td = tds[j] as Element;\n        if (!TableLogic.isTd(td)) continue;\n        let colStart = tdMap[i].findIndex((o: any) => o == null);\n        colStart = colStart == -1 ? tdMap[i].length : colStart;\n        let colEnd = colStart + (td.colSpan || 1),\n          rowStart = i,\n          rowEnd = rowStart + (td.rowSpan || 1);\n        const fillTd = {\n          ...td,\n          colSpan: td.colSpan || 1,\n          rowSpan: td.rowSpan || 1,\n          row: i,\n          col: colStart,\n          originRow: i,\n          originCol: j,\n        };\n        if (td.start) startPoins.push(fillTd as customTdShape);\n\n        for (let row = rowStart; row < rowEnd; row++) {\n          for (let col = colStart; col < colEnd; col++) {\n            tdMap[row][col] = fillTd;\n          }\n        }\n      }\n    }\n    return {\n      tdMap,\n      startPoins,\n    };\n  },\n  getSelectedTdInTdMap(tbody: NodeEntry) {\n    const { tdMap, startPoins } = TdLogic.getTdMap(tbody);\n    if (startPoins.length < 1) return null;\n    if (startPoins.length == 1) startPoins[1] = startPoins[0];\n    if (!tdMap) return null;\n\n    const helper = (\n      {\n        colStart,\n        colEnd,\n        rowStart,\n        rowEnd,\n      }: {\n        colStart: number;\n        colEnd: number;\n        rowStart: number;\n        rowEnd: number;\n      },\n      selectedTdMap: Map<customTdShape, number>\n    ) => {\n      for (let i = rowStart; i < rowEnd; i++) {\n        for (let j = colStart; j < colEnd; j++) {\n          const td = tdMap[i][j];\n          if (!selectedTdMap.has(td)) {\n            selectedTdMap.set(td, 1);\n            helper(\n              {\n                colStart: Math.min(td.col, colStart),\n                colEnd: Math.max(colEnd, td.col + td.colSpan),\n                rowStart: Math.min(td.row, rowStart),\n                rowEnd: Math.max(td.row + td.rowSpan, rowEnd),\n              },\n              selectedTdMap\n            );\n            return;\n          }\n        }\n      }\n    };\n\n    const [a, b] = startPoins;\n    const selectedTd = new Map<customTdShape, number>([\n      [a, 1],\n      [b, 1],\n    ]);\n    helper(\n      {\n        colStart: Math.min(a.col, b.col),\n        colEnd: Math.max(a.col + a.colSpan, b.col + b.colSpan),\n        rowStart: Math.min(a.row, b.row),\n        rowEnd: Math.max(a.row + a.rowSpan, b.row + b.rowSpan),\n      },\n      selectedTd\n    );\n    return selectedTd;\n  },\n  getEditingTd(editor: EditorType) {\n    const [td] = Editor.nodes(editor, {\n      at: [],\n      match(n) {\n        return TableLogic.isTd(n) && n.canTdEdit == true;\n      },\n    });\n    return td;\n  },\n  deselectAllTd(editor: EditorType) {\n    const selectedTdsPath = TableLogic.getSelectedTdsPath(editor);\n    for (const path of selectedTdsPath) {\n      Transforms.unsetNodes(editor, [\"selected\", \"start\", \"canTdEdit\"], {\n        at: path,\n      });\n    }\n    setStrPathSetOfSelectedTds(new Set());\n\n    const editingTdsPath = TableLogic.getEditingTdsPath(editor);\n    for (const tdStrPath of editingTdsPath) {\n      const path: Path = tdStrPath.split(\",\").map((o) => +o);\n      Transforms.unsetNodes(editor, [\"selected\", \"start\", \"canTdEdit\"], {\n        at: path,\n      });\n    }\n    setEditingTdsPath(new Set());\n\n    setPreSelectedTdPos(null);\n  },\n  /**\n   * 找到下一个位置的td\n   */\n  findTargetTd(\n    editor: EditorType,\n    td: NodeEntry,\n    direct: \"left\" | \"right\" | \"up\" | \"down\"\n  ) {\n    if (!td) return;\n    // 首先判断当前是不是只有一个单元格被选中\n    const tbody = Editor.above(editor, {\n      at: td[1],\n      mode: \"lowest\",\n      match(n) {\n        return Element.isElement(n) && n.type == CET.TBODY;\n      },\n    });\n    if (!tbody || !Element.isElement(tbody[0])) return;\n    const { tdMap } = TdLogic.getTdMap(tbody);\n    const preSelectedTdPos = getPreSelectedTdPos();\n    if (!preSelectedTdPos) return;\n\n    let row, col;\n    tdMap.some((tr, i) => {\n      return tr.some((td, j) => {\n        if (td.start == true) {\n          row = i;\n          col = j;\n          return true;\n        }\n        return false;\n      });\n    });\n    if (row == null || col == null) return;\n    const startTd = tdMap[row][col];\n\n    TdLogic.deselectAllTd(editor);\n    let targetCol: number = preSelectedTdPos.col,\n      targetRow: number = preSelectedTdPos.row;\n    if (direct == \"left\") {\n      targetCol =\n        col == 0\n          ? row == 0\n            ? 0\n            : ((targetRow = preSelectedTdPos.row - 1), tdMap[0].length - 1)\n          : col - 1;\n    } else if (direct == \"right\") {\n      const rightX = col + startTd.colSpan;\n      targetCol =\n        rightX >= tdMap[0].length\n          ? row == tdMap.length - 1\n            ? col\n            : ((targetRow = preSelectedTdPos.row + 1), 0)\n          : rightX;\n    } else if (direct == \"up\") {\n      targetRow = row == 0 ? 0 : row - 1;\n    } else if (direct == \"down\") {\n      targetRow =\n        row + startTd.rowSpan >= tdMap.length ? row : row + startTd.rowSpan;\n    }\n    const targetTd = tdMap[targetRow][targetCol];\n\n    setPreSelectedTdPos({\n      row: targetRow,\n      col: targetCol,\n    });\n    Transforms.setNodes(\n      editor,\n      {\n        selected: true,\n        start: true,\n      },\n      {\n        at: [...tbody[1], targetTd.originRow, targetTd.originCol],\n      }\n    );\n  },\n  chooseTd(editor: EditorType, td: NodeEntry) {\n    TdLogic.deselectAllTd(editor);\n    Transforms.deselect(editor);\n    Transforms.setNodes(\n      editor,\n      {\n        selected: true,\n        start: true,\n        canTdEdit: false,\n      },\n      { at: td[1] }\n    );\n    setPreSelectedTdPos({\n      row: td[1][td[1].length - 2],\n      col: td[1][td[1].length - 1],\n    });\n  },\n  clearTd(editor: EditorType) {\n    // 清空带有selected属性的td\n    const selectedTds = TableLogic.getSelectedTds(editor);\n    for (const [, p] of selectedTds) {\n      for (const [, childP] of Node.children(editor, p, {\n        reverse: true,\n      })) {\n        Transforms.removeNodes(editor, { at: childP });\n      }\n      Transforms.unsetNodes(editor, [\"selected\", \"start\"], { at: p });\n    }\n  },\n};\n","/* eslint-disable eqeqeq */\nimport _ from \"lodash\";\nimport { useContext, useRef } from \"react\";\nimport {\n  Node,\n  NodeEntry,\n  Element,\n  Text,\n  Range,\n  Transforms,\n  Editor,\n  Path,\n  Point,\n} from \"slate\";\nimport {\n  ReactEditor,\n  RenderElementProps,\n  useReadOnly,\n  useSlateStatic,\n} from \"slate-react\";\nimport { CET, CustomElement, EditorType, Marks } from \"../common/Defines\";\nimport { utils } from \"../common/utils\";\nimport { EditorContext } from \"../RichEditor\";\nimport { customTdShape, TdLogic, tdMinHeight, tdMinWidth } from \"./Td\";\nimport {\n  getStrPathSetOfSelectedTds,\n  getEditingTdsPath,\n  setStrPathSetOfSelectedTds,\n  setEditingTdsPath,\n  setCopyedCells,\n  setCopyedMaxRowAndCol,\n  getCopyedCells,\n  getCopyedMaxRowAndCol,\n  getCopyedContent,\n} from \"../common/globalStore\";\nimport { message } from \"antd\";\nimport { useEffect } from \"react\";\ndeclare module \"react\" {\n  interface HTMLAttributes<T> extends DOMAttributes<T> {\n    border?: any;\n  }\n}\n\nexport const Table: (props: RenderElementProps) => JSX.Element = ({\n  attributes,\n  children,\n  element,\n}) => {\n  const ref = useRef<{\n    isBeginSelectTd: boolean;\n    mouseDownStartPoint: any;\n    preMouseOnTdPath: Path | null; //  鼠标移动时，记录上一次所处的td\n    lastSelectedPaths: Path[];\n    initX: number;\n    initY: number;\n    prePath: Path | null;\n  }>({\n    isBeginSelectTd: false,\n    mouseDownStartPoint: null,\n    initX: 0,\n    initY: 0,\n    lastSelectedPaths: [],\n    preMouseOnTdPath: null,\n    prePath: null,\n  });\n\n  const { savedMarks, setSavedMarks } = useContext(EditorContext);\n\n  const editor = useSlateStatic();\n  const readOnly = useReadOnly();\n\n  const reCalcTdWidth = () => {\n    const selfDom = attributes.ref.current;\n    if (!selfDom) return;\n    const nowWrapperWidth = selfDom?.offsetWidth - 2;\n    const preWrapperWidth = element.wrapperWidthWhenCreated;\n    const tableDom = selfDom.querySelector(\":scope>table\");\n    if (!tableDom || nowWrapperWidth == null || preWrapperWidth == null) return;\n    if (preWrapperWidth != nowWrapperWidth) {\n      const tableNode = ReactEditor.toSlateNode(editor, selfDom);\n      if (!tableNode) return;\n      const tablePath = ReactEditor.findPath(editor, tableNode);\n      if (!tablePath) return;\n      const trs = Array.from(tableDom.querySelectorAll(\":scope>tbody>tr\"));\n      trs.forEach((tr: any, rowIndex) => {\n        const tds = Array.from(tr.querySelectorAll(\":scope>td\"));\n        tds.forEach((td: any, cellIndex) => {\n          const tdNode = ReactEditor.toSlateNode(editor, td);\n          if (!Element.isElement(tdNode)) return;\n          const width =\n            ((tdNode.width || tdMinWidth) / preWrapperWidth) * nowWrapperWidth;\n          Transforms.setNodes(\n            editor,\n            { width },\n            { at: [...tablePath, 0, rowIndex, cellIndex] }\n          );\n        });\n      });\n      Transforms.setNodes(\n        editor,\n        { wrapperWidthWhenCreated: nowWrapperWidth },\n        { at: tablePath }\n      );\n    }\n  };\n\n  useEffect(() => {\n    // 每次渲染时，判断自己当前的容器宽度是否和之前保存的宽度一致，如果不一致，则计算内部所有td的新的宽度\n    reCalcTdWidth();\n    // 每次渲染时，判断自己的位置和之前的位置相比是否变化，如果变化，需要重新计算自己内部td的状态\n    const path = ReactEditor.findPath(editor, element);\n    if (\n      ref.current.prePath != null &&\n      !Path.equals(path, ref.current.prePath)\n    ) {\n      TableLogic.resetSelectedTds(editor);\n    }\n    ref.current.prePath = path;\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  });\n\n  // 找到需要取消选择和新选择的td的完整的path\n  const findPath = (nowSelectedTds: Path[], preSelectedTds: Path[]) => {\n    const nowSelectedTdsPathSet = new Set(\n      nowSelectedTds.map((o) => o.slice(o.length - 2).join(\",\"))\n    );\n\n    const preSelectedTdsPathSet = new Set(\n      preSelectedTds.map((o) => o.slice(o.length - 2).join(\",\"))\n    );\n\n    const deselectedPath = preSelectedTds.filter((path) => {\n      return !nowSelectedTdsPathSet.has(path.slice(path.length - 2).join(\",\"));\n    });\n\n    const newSelectedPath = nowSelectedTds.filter((path) => {\n      return !preSelectedTdsPathSet.has(path.slice(path.length - 2).join(\",\"));\n    });\n\n    return { deselectedPath, newSelectedPath };\n  };\n\n  const selectTd = _.debounce((pa: Point, pb: Point) => {\n    const commonNode = Node.common(editor, pa.path, pb.path);\n    if (!commonNode) return;\n    const pbTd = Editor.above(editor, {\n      at: pb,\n      mode: \"lowest\",\n      match(n) {\n        return TableLogic.isTd(n);\n      },\n    });\n    if (!pbTd) return;\n\n    const preMouseOnTdPath = ref.current.preMouseOnTdPath;\n    if (preMouseOnTdPath && Path.equals(preMouseOnTdPath, pbTd[1])) return;\n    ref.current.preMouseOnTdPath = pbTd[1];\n\n    const paTd = Editor.above(editor, {\n      at: pa,\n      mode: \"lowest\",\n      match(n) {\n        return TableLogic.isTd(n);\n      },\n    });\n    if (!paTd) return;\n\n    // 取消选择上一次选中的td\n    const deselectTds = () => {\n      ref.current.lastSelectedPaths.forEach((p) => {\n        Transforms.unsetNodes(editor, [\"selected\", \"start\"], {\n          at: p,\n        });\n      });\n      ref.current.lastSelectedPaths = [];\n    };\n\n    ref.current.lastSelectedPaths.forEach((p) => {\n      const td = Editor.node(editor, p);\n      if (td && Element.isElement(td[0]) && td[0].start == true) {\n        Transforms.unsetNodes(editor, [\"start\"], {\n          at: p,\n        });\n      }\n    });\n\n    if (Path.equals(paTd[1], pbTd[1])) {\n      deselectTds();\n      // 说明选区在一个td里\n      Transforms.setNodes(\n        editor,\n        { selected: true, start: true },\n        { at: paTd[1] }\n      );\n      return;\n    }\n    if (\n      !Element.isElement(commonNode[0]) ||\n      (commonNode[0].type != CET.TBODY && commonNode[0].type != CET.TR)\n    ) {\n      deselectTds();\n      return;\n    }\n\n    // 找到两个点同一层级的td\n    const tda = Editor.above(editor, {\n      at: pa,\n      mode: \"highest\",\n      match(n, p) {\n        return TableLogic.isTd(n) && p.length > commonNode[1].length;\n      },\n    });\n    if (!tda) return;\n    Transforms.setNodes(\n      editor,\n      { start: true, selected: true },\n      { at: tda[1] }\n    );\n    const tdb = Editor.above(editor, {\n      at: pb,\n      mode: \"highest\",\n      match(n, p) {\n        return TableLogic.isTd(n) && p.length > commonNode[1].length;\n      },\n    });\n    if (!tdb) return;\n    Transforms.setNodes(\n      editor,\n      { start: true, selected: true },\n      { at: tdb[1] }\n    );\n\n    const tbody = Editor.above(editor, {\n      at: tda[1],\n      mode: \"lowest\",\n      match(n) {\n        return Element.isElement(n) && n.type == CET.TBODY;\n      },\n    });\n    if (!tbody || !Element.isElement(tbody[0])) return;\n\n    const selectedTds = TdLogic.getSelectedTdInTdMap(tbody);\n    if (selectedTds == null) return;\n    const nowTdsPath = Array.from(selectedTds.keys()).map((o) => [\n      ...tbody[1],\n      o.originRow,\n      o.originCol,\n    ]);\n\n    const { deselectedPath, newSelectedPath } = findPath(\n      nowTdsPath,\n      ref.current.lastSelectedPaths\n    );\n\n    for (const path of newSelectedPath) {\n      Transforms.setNodes(editor, { selected: true }, { at: path });\n    }\n\n    for (const path of deselectedPath) {\n      Transforms.unsetNodes(editor, [\"selected\", \"start\"], { at: path });\n    }\n\n    ref.current.lastSelectedPaths = nowTdsPath;\n  }, 5);\n\n  const mousedownFunc = (e: any) => {\n    // 防止事件冒泡到父元素的td\n    e.stopPropagation();\n    try {\n      const slateNode = ReactEditor.toSlateNode(editor, e.target);\n      const path = ReactEditor.findPath(editor, slateNode);\n      ref.current.initX = e.clientX;\n      ref.current.initY = e.clientY;\n\n      ref.current.preMouseOnTdPath = null;\n      ref.current.lastSelectedPaths = [];\n\n      const tdDom = e.nativeEvent.path.find((e: any) => {\n        return e.tagName == \"TD\";\n      });\n      if (!tdDom) return;\n\n      if (\n        !readOnly &&\n        ![\"resizer\", \"columnSelector\"].includes(e.target.className) &&\n        tdDom.contentEditable === \"false\"\n      ) {\n        ref.current.isBeginSelectTd = true;\n        ref.current.mouseDownStartPoint = path;\n\n        for (const [, p] of Editor.nodes(editor, {\n          at: [],\n          match(n) {\n            return (\n              TableLogic.isTd(n) && (n.selected == true || n.start == true)\n            );\n          },\n        })) {\n          ref.current.lastSelectedPaths.push(p);\n        }\n        ref.current.preMouseOnTdPath = path;\n\n        window.onmousemove = mousemoveFunc;\n        window.onmouseup = mouseupFunc;\n      }\n    } catch (error) {}\n  };\n  const mousemoveFunc = (e: any) => {\n    try {\n      // 如果移动距离不超过1，那么不进入逻辑\n      if (\n        ref.current.isBeginSelectTd &&\n        (Math.abs(e.clientX - ref.current.initX) > 1 ||\n          Math.abs(e.clientY - ref.current.initY) > 1)\n      ) {\n        const slateNode = ReactEditor.toSlateNode(editor, e.target);\n        const path = ReactEditor.findPath(editor, slateNode);\n        selectTd(\n          Editor.point(editor, ref.current.mouseDownStartPoint),\n          Editor.point(editor, path)\n        );\n      }\n    } catch (error) {}\n  };\n  const mouseupFunc = (e: any) => {\n    ref.current.isBeginSelectTd = false;\n    window.onmousemove = () => {};\n    window.onmousedown = () => {};\n    window.onmouseup = () => {};\n  };\n\n  return (\n    <div\n      {...attributes}\n      style={{\n        display: \"inline-block\",\n        position: \"relative\",\n        width: \"100%\",\n        overflowX: \"auto\",\n        overflowY: \"hidden\",\n      }}\n    >\n      <table\n        border=\"1\"\n        {...attributes}\n        style={{\n          tableLayout: \"auto\",\n          wordBreak: \"break-all\",\n          overflowX: \"auto\",\n          overflowY: \"hidden\",\n          borderCollapse: \"collapse\",\n        }}\n        onMouseDown={mousedownFunc}\n        onMouseUp={() => {\n          if (savedMarks) {\n            const copyMarks: any = {};\n            const hasSelectTd = TableLogic.getSelectedTdsSize(editor);\n            for (const key of Object.values(Marks)) {\n              copyMarks[key] = savedMarks[key];\n            }\n            if (hasSelectTd > 0) {\n              const selectedTdsPath = TableLogic.getSelectedTdsPath(editor);\n              for (const path of selectedTdsPath) {\n                Transforms.setNodes(editor, copyMarks, {\n                  at: path,\n                });\n              }\n              setSavedMarks(null);\n              return;\n            }\n          }\n        }}\n      >\n        {children}\n      </table>\n    </div>\n  );\n};\n\nconst getEditingOrSelectedTdBelongTable = (editor: Editor) => {\n  const td = TableLogic.getFirstSelectedTd(editor);\n  let table;\n  if (td) {\n    table = Editor.above(editor, {\n      mode: \"lowest\",\n      at: td[1],\n      match(n) {\n        return TableLogic.isTable(n);\n      },\n    });\n  } else if (editor.selection) {\n    table = Editor.above(editor, {\n      mode: \"lowest\",\n      match(n) {\n        return TableLogic.isTable(n);\n      },\n    });\n  }\n  return table;\n};\n\nexport const TableLogic = {\n  model: [\n    {\n      type: CET.TABLE,\n      children: [\n        {\n          type: CET.TBODY,\n          children: new Array(100).fill(0).map((item, fatherIndex) => {\n            return {\n              type: CET.TR,\n              children: new Array(10).fill(0).map((item, index) => {\n                return {\n                  type: CET.TD,\n                  width: 100,\n                  height: 50,\n                  children: [\n                    {\n                      type: CET.DIV,\n                      children: [{ text: `string${fatherIndex}-${index}` }],\n                    },\n                  ],\n                };\n              }),\n            };\n          }),\n        },\n      ],\n    },\n    {\n      type: CET.DIV,\n      children: [{ text: \"1\" }],\n    },\n  ],\n  isSelectedTd(n: Node) {\n    return TableLogic.isTd(n) && n.selected == true;\n  },\n  isTable(node: Node): node is Element {\n    return Element.isElement(node) && CET.TABLE == node.type;\n  },\n  isTd(node: Node): node is Element {\n    return Element.isElement(node) && [CET.TD].includes(node.type);\n  },\n  isInTd(editor: EditorType) {\n    if (editor.selection && Range.isCollapsed(editor.selection)) {\n      return utils.getFirstAboveElementType(editor) == CET.TD;\n    }\n    return false;\n  },\n  normalizeTable(editor: EditorType, nodeEntry: NodeEntry) {\n    const [node, path] = nodeEntry;\n\n    if (Element.isElement(node) && [CET.TABLE].includes(node.type)) {\n      // 如果table的子元素里含有其他非tbody的标签，删除\n      for (const [child, childP] of Node.children(editor, path, {\n        reverse: true,\n      })) {\n        if (child.type != CET.TBODY) {\n          Transforms.removeNodes(editor, { at: childP });\n          return;\n        }\n      }\n    }\n\n    // tbody校验规则\n    if (Element.isElement(node) && [CET.TBODY].includes(node.type)) {\n      // 如果tbody的父元素不是table，则删除\n      const [parent] = utils.getParent(editor, path);\n      if (!(Element.isElement(parent) && parent.type == CET.TABLE)) {\n        Transforms.removeNodes(editor, { at: path });\n        return true;\n      }\n      for (const [child, childP] of Node.children(editor, path, {\n        reverse: true,\n      })) {\n        if (child.type != CET.TR) {\n          Transforms.removeNodes(editor, { at: childP });\n          return;\n        }\n      }\n    }\n\n    // tr校验规则\n    if (Element.isElement(node) && CET.TR == node.type) {\n      // 如果父元素不为tbody，则删除\n      const [parent] = utils.getParent(editor, path);\n      if (!(Element.isElement(parent) && [CET.TBODY].includes(parent.type))) {\n        Transforms.removeNodes(editor, { at: path });\n        return true;\n      }\n      for (const [child, childP] of Node.children(editor, path, {\n        reverse: true,\n      })) {\n        if (child.type != CET.TD) {\n          Transforms.removeNodes(editor, { at: childP });\n          return;\n        }\n      }\n      if (node.children.length == 1 && Node.child(node, 0).type != CET.TD) {\n        Transforms.setNodes(editor, { shouldEmpty: true }, { at: path });\n        return true;\n      } else {\n        if (node.children.length > 1) {\n          for (const [child, childP] of Node.children(editor, path, {\n            reverse: true,\n          })) {\n            if (Text.isText(child)) {\n              Transforms.removeNodes(editor, { at: childP });\n              return true;\n            }\n          }\n        }\n\n        Transforms.setNodes(editor, { shouldEmpty: false }, { at: path });\n        return true;\n      }\n    }\n    // td校验\n    if (Element.isElement(node) && CET.TD == node.type) {\n      // 如果父元素不是tr，则删除\n      const [parent] = utils.getParent(editor, path);\n      if (!(Element.isElement(parent) && [CET.TR].includes(parent.type))) {\n        Transforms.removeNodes(editor, { at: path });\n        return true;\n      }\n      // 如果没有子元素，那么默认添加一个\n      if (\n        node.children.length == 1 &&\n        Text.isText(Node.child(node, 0)) &&\n        Editor.string(editor, path, { voids: true }) == \"\"\n      ) {\n        Transforms.wrapNodes(\n          editor,\n          {\n            type: CET.DIV,\n            children: [{ text: \"\" }],\n          },\n          {\n            at: [...path, 0],\n          }\n        );\n        return true;\n      }\n    }\n  },\n  tabEvent(editor: EditorType) {\n    const td = TdLogic.getEditingTd(editor);\n    if (!td) return;\n\n    Transforms.deselect(editor);\n    TdLogic.findTargetTd(editor, td, \"right\");\n  },\n  shiftTabEvent(editor: EditorType) {\n    const td = TdLogic.getEditingTd(editor);\n    if (!td) return;\n\n    Transforms.deselect(editor);\n    TdLogic.findTargetTd(editor, td, \"left\");\n  },\n  deleteRow(editor: EditorType) {\n    // 删除选区对应的列\n    let deleteVArea: number[] = [Infinity, -Infinity];\n    const selectedTd = TableLogic.getFirstSelectedTd(editor);\n    if (!selectedTd) return;\n\n    const tbody = Editor.above(editor, {\n      at: selectedTd[1],\n      match(n) {\n        return Element.isElement(n) && n.type == CET.TBODY;\n      },\n    });\n    if (!tbody) return;\n    const { tdMap } = TdLogic.getTdMap(tbody);\n    if (!tdMap) return;\n    const selectedTds = Array.from(\n      TdLogic.getSelectedTdInTdMap(tbody)?.keys() || []\n    );\n    if (selectedTds.length == 0) return;\n\n    selectedTds.forEach((td) => {\n      deleteVArea[0] = Math.min(deleteVArea[0], td.row);\n      deleteVArea[1] = Math.max(deleteVArea[1], td.row + td.rowSpan);\n    });\n\n    // 说明是整个表格所有行被删除\n    if (deleteVArea[1] - deleteVArea[0] == tdMap.length) {\n      // 直接删除表格\n      Transforms.removeNodes(editor, {\n        at: Path.parent(tbody[1]),\n      });\n      return;\n    }\n\n    const removePath = [];\n    for (let row = deleteVArea[0]; row < deleteVArea[1]; row++) {\n      removePath.unshift([...tbody[1], row]);\n      for (let col = 0; col < tdMap[row].length; col++) {\n        const td = tdMap[row][col];\n        td.rowSpan--;\n        const tdPath = [...tbody[1], td.originRow, td.originCol];\n        // 如果rowSpan被减去到0，说明这个cell在要删除的行里\n        if (td.rowSpan != 0) {\n          Transforms.setNodes(\n            editor,\n            {\n              rowSpan: td.rowSpan,\n            },\n            {\n              at: tdPath,\n            }\n          );\n        }\n        col += td.colSpan - 1;\n      }\n    }\n\n    // 再次遍历，找到那些起始点身处删除范围内，且rowSpan>0的\n    for (let row = deleteVArea[0]; row < deleteVArea[1]; row++) {\n      for (let col = 0; col < tdMap[row].length; col++) {\n        const td = tdMap[row][col];\n        if (\n          td.rowSpan > 0 &&\n          td.row >= deleteVArea[0] &&\n          td.row == row &&\n          td.col == col\n        ) {\n          const targetRow = deleteVArea[1];\n          const leftCol = tdMap[targetRow][td.col - 1];\n          if (leftCol) {\n            Transforms.moveNodes(editor, {\n              at: [...tbody[1], td.originRow, td.originCol],\n              to: [...tbody[1], targetRow, leftCol.originCol + 1],\n            });\n          } else {\n            Transforms.moveNodes(editor, {\n              at: [...tbody[1], td.originRow, td.originCol],\n              to: [...tbody[1], targetRow, 0],\n            });\n          }\n        }\n        col += td.colSpan - 1;\n      }\n    }\n\n    // 从最低点开始删除\n    removePath.forEach((path) => {\n      Transforms.removeNodes(editor, { at: path });\n    });\n\n    TableLogic.resetSelectedTds(editor);\n  },\n  deleteColumn(editor: EditorType) {\n    // 删除选区对应的列\n    let deleteHArea: number[] = [Infinity, -Infinity];\n    const selectedTd = TableLogic.getFirstSelectedTd(editor);\n    if (!selectedTd) return;\n\n    const tbody = Editor.above(editor, {\n      at: selectedTd[1],\n      match(n) {\n        return Element.isElement(n) && n.type == CET.TBODY;\n      },\n    });\n    if (!tbody) return;\n    const { tdMap } = TdLogic.getTdMap(tbody);\n    if (!tdMap) return;\n    const selectedTds = Array.from(\n      TdLogic.getSelectedTdInTdMap(tbody)?.keys() || []\n    );\n    if (selectedTds.length == 0) return;\n\n    selectedTds.forEach((td) => {\n      deleteHArea[0] = Math.min(deleteHArea[0], td.col);\n      deleteHArea[1] = Math.max(deleteHArea[1], td.col + td.colSpan);\n    });\n\n    // 说明是整个表格所有列被删除\n    if (deleteHArea[1] - deleteHArea[0] == tdMap[0].length) {\n      // 直接删除表格\n      Transforms.removeNodes(editor, {\n        at: Path.parent(tbody[1]),\n      });\n      return;\n    }\n\n    const removePath = [];\n    for (let col = deleteHArea[0]; col < deleteHArea[1]; col++) {\n      for (let row = 0; row < tdMap.length; row++) {\n        const td = tdMap[row][col];\n        td.colSpan--;\n        const tdPath = [...tbody[1], td.originRow, td.originCol];\n        if (td.colSpan == 0) {\n          removePath.push(tdPath);\n        } else {\n          Transforms.setNodes(\n            editor,\n            {\n              colSpan: td.colSpan,\n            },\n            {\n              at: tdPath,\n            }\n          );\n        }\n        row += td.rowSpan - 1;\n      }\n    }\n\n    // 从最低点开始删除\n    removePath.sort((a, b) => {\n      const arow = a[a.length - 2];\n      const brow = b[b.length - 2];\n      const acol = a[a.length - 1];\n      const bcol = b[b.length - 1];\n      return arow > brow ? -1 : arow == brow ? bcol - acol : 1;\n    });\n    removePath.forEach((path) => {\n      Transforms.removeNodes(editor, { at: path });\n    });\n\n    TableLogic.resetSelectedTds(editor);\n  },\n  insertColumn(\n    editor: EditorType,\n    type: \"before\" | \"after\",\n    count: number = 1\n  ) {\n    let nowTd = TableLogic.getFirstSelectedTd(editor);\n    // 如果没有选中的td，那么就从光标位置找\n    if (!nowTd && editor.selection) {\n      [nowTd] = Editor.nodes(editor, {\n        mode: \"lowest\",\n        match(n) {\n          return TableLogic.isTd(n);\n        },\n      });\n    }\n    if (!nowTd) return;\n    const nowTr = Editor.parent(editor, nowTd[1]);\n    if (!nowTr) return;\n    const tbody = Editor.parent(editor, nowTr[1]);\n    if (!tbody) return;\n    const { tdMap } = TdLogic.getTdMap(tbody);\n    const selectedTds = TdLogic.getSelectedTdInTdMap(tbody);\n    if (\n      !Element.isElement(nowTd[0]) ||\n      !Element.isElement(nowTd[0]) ||\n      !Element.isElement(tbody[0])\n    )\n      return;\n\n    const editorDom = ReactEditor.toDOMNode(editor, editor);\n\n    const getInsertCells = (): CustomElement[] => {\n      return _.cloneDeep(\n        new Array(count).fill(0).map(() => {\n          return _.cloneDeep({\n            type: CET.TD,\n            width: editorDom.offsetWidth / 10,\n            height: tdMinHeight,\n            children: [\n              {\n                type: CET.DIV,\n                children: [{ text: \"\" }],\n              },\n            ],\n          } as CustomElement);\n        })\n      );\n    };\n\n    // 首先找到第一插入点\n    const [nowTdRow, nowTdCol] = nowTd[1].slice(nowTd[1].length - 2);\n    let insertCol;\n    if (selectedTds && selectedTds.size > 0) {\n      insertCol = type == \"after\" ? -Infinity : Infinity;\n      for (const tdInTdMap of selectedTds.keys()) {\n        insertCol =\n          type == \"after\"\n            ? Math.max(insertCol, tdInTdMap.col + tdInTdMap.colSpan)\n            : Math.min(insertCol, tdInTdMap.col);\n      }\n    } else {\n      insertCol = -1;\n      for (let i = 0; i < tdMap[nowTdRow].length; i++) {\n        const td = tdMap[nowTdRow][i];\n        // 找到当前td在tdMap中的位置\n        if (td.originCol == nowTdCol && td.originRow == nowTdRow) {\n          insertCol = td.col + (type == \"after\" ? td.colSpan : 0);\n          break;\n        }\n      }\n    }\n    if (insertCol == null || !Number.isFinite(insertCol)) return;\n    // 从上到下遍历整个表格当前列\n    for (let row = 0; row < tdMap.length; row++) {\n      const downTd = tdMap[row][insertCol] as customTdShape;\n      // 如果不存在，那么说明是插在最后\n      if (!downTd) {\n        Transforms.insertNodes(editor, getInsertCells(), {\n          at: [\n            ...tbody[1],\n            row,\n            tbody[0]?.children?.[row]?.children?.length || 0,\n          ],\n        });\n        continue;\n      }\n      const downTdOriginPos = [...tbody[1], downTd.originRow, downTd.originCol];\n      if (downTd.col == insertCol) {\n        Transforms.insertNodes(editor, getInsertCells(), {\n          at: [...tbody[1], row, downTd.originCol],\n        });\n      } else {\n        Transforms.setNodes(\n          editor,\n          {\n            colSpan: downTd.colSpan + 1,\n          },\n          {\n            at: downTdOriginPos,\n          }\n        );\n        row += downTd.rowSpan - 1;\n      }\n    }\n    TableLogic.resetSelectedTds(editor);\n  },\n  insertRow(editor: EditorType, type: \"after\" | \"before\", count: number = 1) {\n    let nowTd = TableLogic.getFirstSelectedTd(editor);\n    // 如果没有选中的td，那么就从光标位置找\n    if (!nowTd && editor.selection) {\n      [nowTd] = Editor.nodes(editor, {\n        mode: \"lowest\",\n        match(n) {\n          return TableLogic.isTd(n);\n        },\n      });\n    }\n    if (!nowTd) return;\n    const nowTr = Editor.parent(editor, nowTd[1]);\n    if (!nowTr) return;\n    const tbody = Editor.parent(editor, nowTr[1]);\n    if (!tbody) return;\n    const { tdMap } = TdLogic.getTdMap(tbody);\n    const selectedTds = TdLogic.getSelectedTdInTdMap(tbody);\n    if (\n      !Element.isElement(nowTd[0]) ||\n      !Element.isElement(nowTd[0]) ||\n      !Element.isElement(tbody[0])\n    )\n      return;\n\n    const editorDom = ReactEditor.toDOMNode(editor, editor);\n\n    const insertNode = {\n      type: CET.TD,\n      width: editorDom.offsetWidth / 10,\n      height: tdMinHeight,\n      children: [\n        {\n          type: CET.DIV,\n          children: [{ text: \"\" }],\n        },\n      ],\n    };\n\n    // 首先找到第一插入点\n    const [nowTdRow, nowTdCol] = nowTd[1].slice(nowTd[1].length - 2);\n    let insertRow;\n    if (selectedTds && selectedTds.size > 0) {\n      insertRow = type == \"after\" ? -Infinity : Infinity;\n      for (const tdInTdMap of selectedTds.keys()) {\n        insertRow =\n          type == \"after\"\n            ? Math.max(insertRow, tdInTdMap.row + tdInTdMap.rowSpan)\n            : Math.min(insertRow, tdInTdMap.row);\n      }\n    } else {\n      insertRow = -1;\n      for (let i = 0; i < tdMap[nowTdRow].length; i++) {\n        const td = tdMap[nowTdRow][i];\n        // 找到当前td在tdMap中的位置\n        if (td.originCol == nowTdCol && td.originRow == nowTdRow) {\n          insertRow = td.row + (type == \"after\" ? td.rowSpan : 0);\n          break;\n        }\n      }\n    }\n    if (insertRow == -1 || !Number.isFinite(insertRow)) return;\n\n    const getInsertRow = (tdCount: number) => {\n      return new Array(count).fill(0).map(() => {\n        return _.cloneDeep({\n          type: CET.TR,\n          children: new Array(tdCount).fill(0).map(() => {\n            return _.cloneDeep(insertNode);\n          }),\n        });\n      });\n    };\n\n    // 最后一行的插入\n    if (tdMap[insertRow] == null) {\n      Transforms.insertNodes(editor, getInsertRow(tdMap[0].length), {\n        at: [...tbody[1], insertRow],\n      });\n      return;\n    }\n\n    // 找到tdMap中的当前行\n    let tdCount = 0;\n    for (let i = 0; i < tdMap[insertRow].length; i++) {\n      const td = tdMap[insertRow][i] as customTdShape;\n      if (td.row == insertRow) {\n        tdCount++;\n      } else {\n        Transforms.setNodes(\n          editor,\n          {\n            rowSpan: td.rowSpan + 1,\n          },\n          {\n            at: [...tbody[1], td.originRow, td.originCol],\n          }\n        );\n        i += td.colSpan - 1;\n      }\n    }\n\n    Transforms.insertNodes(editor, getInsertRow(tdCount), {\n      at: [...tbody[1], insertRow],\n    });\n\n    TableLogic.resetSelectedTds(editor);\n  },\n  splitTd(editor: EditorType) {\n    const selectedTds = Editor.nodes(editor, {\n      at: [],\n      match(n) {\n        return TableLogic.isSelectedTd(n);\n      },\n    });\n    if (!selectedTds) return;\n\n    let tbody = null;\n    for (const [td, tdPath] of selectedTds) {\n      if (!Element.isElement(td)) continue;\n      Transforms.setNodes(editor, { colSpan: 1, rowSpan: 1 }, { at: tdPath });\n      Transforms.unsetNodes(editor, [\"selected\", \"start\"], { at: tdPath });\n      if ((!td.colSpan || td.colSpan < 2) && (!td.rowSpan || td.rowSpan < 2))\n        continue;\n\n      if (!tbody) {\n        tbody = Editor.above(editor, {\n          at: tdPath,\n          mode: \"lowest\",\n          match(n) {\n            return Element.isElement(n) && n.type == CET.TBODY;\n          },\n        });\n        if (!tbody) continue;\n      }\n\n      const belongTr = Editor.parent(editor, tdPath),\n        tdCol = tdPath[tdPath.length - 1],\n        tdRow = tdPath[tdPath.length - 2],\n        tdColSpan = td.colSpan || 1,\n        tdRowSpan = td.rowSpan || 1;\n      let leftSumColSpan = 0;\n      for (let i = 0; i < tdCol; i++) {\n        leftSumColSpan =\n          leftSumColSpan + (belongTr[0]?.children?.[i]?.colSpan || 1);\n      }\n\n      // 找到当前tr应该插入新td的位置\n      const findInsertCol = (tr: NodeEntry) => {\n        let sumColSpan = 0;\n        for (let i = 0; i < tr[0].children.length; i++) {\n          sumColSpan = sumColSpan + (tr[0].children[i].colSpan || 1);\n          if (sumColSpan == leftSumColSpan) return i + 1;\n        }\n        return 0;\n      };\n\n      for (let row = tdRow, count = 0; count < tdRowSpan; count++, row++) {\n        const isInNowTr = row == tdRow;\n        const insertCol = findInsertCol(\n          Editor.node(editor, [...tbody[1], row])\n        );\n\n        // 插入几个td\n        const insertTdCount = tdColSpan - (isInNowTr ? 1 : 0);\n        Transforms.insertNodes(\n          editor,\n          new Array(insertTdCount).fill(0).map(() => {\n            return _.cloneDeep({\n              type: CET.TD,\n              children: [\n                {\n                  type: CET.DIV,\n                  children: [{ text: \"\" }],\n                },\n              ],\n            });\n          }),\n          {\n            at: [...tbody[1], row, insertCol + (isInNowTr ? 1 : 0)],\n          }\n        );\n      }\n      TableLogic.splitTd(editor);\n      TableLogic.resetSelectedTds(editor);\n      return;\n    }\n  },\n  mergeTd(editor: EditorType) {\n    const isOnlyOne = TableLogic.getSelectedTdsSize(editor) == 1;\n\n    const selectedTd = TableLogic.getFirstSelectedTd(editor);\n    if (!selectedTd || isOnlyOne == null) return;\n\n    const tbody = Editor.above(editor, {\n      at: selectedTd[1],\n      mode: \"lowest\",\n      match(n) {\n        return Element.isElement(n) && n.type == CET.TBODY;\n      },\n    });\n    if (!tbody) return;\n\n    const selectedTds = TdLogic.getSelectedTdInTdMap(tbody);\n    if (!selectedTds) return;\n    const tbodyPath = tbody[1];\n    const tds = Array.from(selectedTds?.keys());\n\n    tds.sort((a, b) => {\n      if (a.row > b.row) {\n        return 1;\n      }\n      if (a.row == b.row) {\n        return a.col - b.col;\n      }\n      return -1;\n    });\n\n    let firstTd = tds[0];\n    let maxColSpan = 0,\n      maxRowSpan = 0;\n    tds.forEach((td) => {\n      maxColSpan = Math.max(maxColSpan, td.colSpan + td.col - firstTd.col);\n      maxRowSpan = Math.max(maxRowSpan, td.rowSpan + td.row - firstTd.row);\n    });\n\n    const newTdPath = [...tbodyPath, firstTd.originRow, firstTd.originCol];\n    Transforms.setNodes(\n      editor,\n      {\n        colSpan: maxColSpan,\n        rowSpan: maxRowSpan,\n      },\n      { at: newTdPath }\n    );\n\n    const firstTdEntry = Editor.node(editor, newTdPath);\n    tds.forEach((td) => {\n      if (td.col == firstTd.col && td.row == firstTd.row) return;\n      const tdPath = [...tbodyPath, td.originRow, td.originCol];\n      for (const [, childP] of Node.children(editor, tdPath, {\n        reverse: true,\n      })) {\n        if (Editor.string(editor, childP, { voids: true }) == \"\") continue;\n        Transforms.moveNodes(editor, {\n          at: childP,\n          to: [...firstTdEntry[1], firstTdEntry[0].children.length],\n        });\n      }\n      Transforms.setNodes(editor, { toBeDeleted: true }, { at: tdPath });\n    });\n\n    Transforms.removeNodes(editor, {\n      at: [],\n      match(n) {\n        return TableLogic.isTd(n) && n.toBeDeleted == true;\n      },\n    });\n\n    TableLogic.resetSelectedTds(editor);\n  },\n  deleteTable(editor: EditorType) {\n    const table = getEditingOrSelectedTdBelongTable(editor);\n    if (!table) return;\n    Transforms.removeNodes(editor, { at: table[1] });\n    TableLogic.resetSelectedTds(editor);\n  },\n  insertDivAfterTable(editor: EditorType) {\n    const table = getEditingOrSelectedTdBelongTable(editor);\n\n    if (!table) return;\n    const nextPath = utils.getPath(table[1], \"next\");\n    Transforms.insertNodes(\n      editor,\n      {\n        type: CET.DIV,\n        children: [{ text: \"write something...\" }],\n      },\n      { at: nextPath }\n    );\n    TableLogic.resetSelectedTds(editor);\n  },\n  insertDivBeforeTable(editor: EditorType) {\n    const table = getEditingOrSelectedTdBelongTable(editor);\n\n    if (!table) return;\n    Transforms.insertNodes(\n      editor,\n      {\n        type: CET.DIV,\n        children: [{ text: \"write something...\" }],\n      },\n      { at: table[1] }\n    );\n    TableLogic.resetSelectedTds(editor);\n  },\n  getSelectedTdsPath(editor: EditorType) {\n    const selectedTds = getStrPathSetOfSelectedTds(editor);\n    const pathArr = [];\n    for (const tdStrPath of selectedTds) {\n      const path: Path = tdStrPath.split(\",\").map((o) => +o);\n      pathArr.push(path);\n    }\n    return pathArr;\n  },\n  getSelectedTds(editor: EditorType) {\n    const selectedTds = getStrPathSetOfSelectedTds(editor);\n    const tdArr = [];\n    for (const tdStrPath of selectedTds) {\n      const path: Path = tdStrPath.split(\",\").map((o) => +o);\n      const td = Editor.node(editor, path);\n      tdArr.push(td);\n    }\n    return tdArr;\n  },\n  getFirstSelectedTd(editor: EditorType) {\n    const selectedTds = getStrPathSetOfSelectedTds(editor);\n    const arr = Array.from(selectedTds).sort((a, b) =>\n      a > b ? 1 : a === b ? 0 : -1\n    );\n    if (arr.length == 0) return null;\n\n    const path: Path = arr[0].split(\",\").map((o) => +o);\n    const td = Editor.node(editor, path);\n    return td;\n  },\n  getEditingTds(editor: EditorType) {\n    const editingTdsPath = getEditingTdsPath(editor);\n    const arr = [];\n    for (const tdStrPath of editingTdsPath) {\n      const path: Path = tdStrPath.split(\",\").map((o) => +o);\n      arr.push(Editor.node(editor, path));\n    }\n    return arr;\n  },\n  getEditingTdsPath(editor: EditorType): Set<string> {\n    return getEditingTdsPath(editor);\n  },\n  getSelectedTdsSize(editor: EditorType) {\n    return getStrPathSetOfSelectedTds(editor).size;\n  },\n  resetSelectedTds(editor: EditorType) {\n    const tdsPath = Array.from(\n      Editor.nodes(editor, {\n        at: [],\n        match(n) {\n          return TableLogic.isSelectedTd(n);\n        },\n      })\n    ).map((o) => o[1].join(\",\"));\n\n    setStrPathSetOfSelectedTds(new Set(tdsPath));\n\n    const editingTdsPath = Array.from(\n      Editor.nodes(editor, {\n        at: [],\n        match(n) {\n          return TableLogic.isTd(n) && n.canTdEdit == true;\n        },\n      })\n    ).map((o) => o[1].join(\",\"));\n\n    setEditingTdsPath(new Set(editingTdsPath));\n  },\n  copyCells(editor: EditorType) {\n    const selectedTds = TableLogic.getSelectedTds(editor);\n    setCopyedCells(\n      selectedTds.sort((a, b) => {\n        const [arow, acol] = a[1].slice(a[1].length - 2);\n        const [brow, bcol] = b[1].slice(b[1].length - 2);\n        return arow > brow ? 1 : arow === brow ? acol - bcol : -1;\n      })\n    );\n    const tbody = Editor.above(editor, {\n      at: selectedTds[0][1],\n      mode: \"lowest\",\n      match(n) {\n        return Element.isElement(n) && n.type === CET.TBODY;\n      },\n    });\n    if (!tbody) return;\n    const tds = Array.from(\n      TdLogic.getSelectedTdInTdMap(tbody)?.keys() || ([] as customTdShape[])\n    );\n    const { startPoins } = TdLogic.getTdMap(tbody);\n    let areaWidth = 0,\n      areaHeight = 0;\n    tds.forEach((td) => {\n      const { row, col } = td;\n      areaWidth = Math.max(\n        col + (td.colSpan || 1) - startPoins[0].col,\n        areaWidth\n      );\n      areaHeight = Math.max(\n        row + (td.rowSpan || 1) - startPoins[0].row,\n        areaHeight\n      );\n    });\n    setCopyedMaxRowAndCol({\n      copyedAreaWidth: areaWidth,\n      copyedAreaHeight: areaHeight,\n    });\n  },\n  pasteCells(editor: EditorType) {\n    const copyedContent = getCopyedContent();\n    if (copyedContent) {\n      // 将复制的内容全部加入到选择的td中\n      const selectedTdsPath = Array.from(TableLogic.getSelectedTdsPath(editor));\n      TdLogic.clearTd(editor);\n      for (const path of selectedTdsPath) {\n        Transforms.insertNodes(editor, _.cloneDeep(copyedContent), {\n          at: [...path, 0],\n        });\n        Transforms.removeNodes(editor, {\n          at: [...path, Array.from(Node.children(editor, path)).length - 1],\n        });\n      }\n      return;\n    }\n    // 检查复制的单元格区域能否完全覆盖目标区域\n    const copyedCells = getCopyedCells();\n    if (!copyedCells) return;\n    const { copyedAreaWidth: areaWidth, copyedAreaHeight: areaHeight } =\n      getCopyedMaxRowAndCol();\n    const selectedTds = Array.from(TableLogic.getSelectedTds(editor));\n    const tbody = Editor.above(editor, {\n      at: selectedTds[0][1],\n      mode: \"lowest\",\n      match(n) {\n        return Element.isElement(n) && n.type === CET.TBODY;\n      },\n    });\n    if (!tbody) return;\n    // 如果复制的单元格只有一个，那么将选中的单元格的内容全部替换成复制的单元格内容\n    if (copyedCells.length == 1) {\n      const copyedTd = copyedCells.pop();\n      if (!copyedTd) return;\n      selectedTds.forEach((td) => {\n        const childLength = td[0].children.length;\n        Transforms.insertNodes(editor, _.cloneDeep(copyedTd[0].children), {\n          at: [...td[1], 0],\n        });\n        for (const [, childP] of Node.children(editor, td[1], {\n          reverse: true,\n        })) {\n          if (childP[childP.length - 1] == childLength - 1) break;\n          Transforms.removeNodes(editor, {\n            at: childP,\n          });\n        }\n      });\n      return;\n    }\n    const { tdMap, startPoins } = TdLogic.getTdMap(tbody);\n    const startPoint = startPoins[0];\n    if (\n      startPoint.row + areaHeight > tdMap.length ||\n      startPoint.col + areaWidth > tdMap[0].length\n    ) {\n      message.error(\"无法完整覆盖目标区域\");\n      return false;\n    }\n    const waitToDeleteTdsPath = [];\n    // 验证覆盖区域是否合法\n    for (\n      let row = startPoint.row;\n      row < tdMap.length && row < startPoint.row + areaHeight;\n      row++\n    ) {\n      for (\n        let col = startPoint.col;\n        col < tdMap[0].length && col < startPoint.col + areaWidth;\n        col++\n      ) {\n        const td = tdMap[row][col];\n        waitToDeleteTdsPath.unshift([td.originRow, td.originCol]);\n        if (\n          td.col < startPoint.col ||\n          td.col + td.colSpan > startPoint.col + areaWidth ||\n          td.row < startPoint.row ||\n          td.row + td.rowSpan > startPoint.row + areaHeight\n        ) {\n          message.error(\"无法完整覆盖目标区域\");\n          return false;\n        }\n      }\n    }\n\n    // 缓存之前复制的td\n    _.uniqWith(waitToDeleteTdsPath, (a, b) => {\n      return a.join(\",\") === b.join(\",\");\n    }).forEach((path) => {\n      Transforms.removeNodes(editor, { at: [...tbody[1], ...path] });\n    });\n\n    let minRow = copyedCells.slice().reduce((p, c) => {\n      return Math.min(p, c[1][c[1].length - 2]);\n    }, Infinity);\n\n    for (\n      let row = startPoint.row, nowCopyedCellsRow = minRow;\n      row < startPoint.row + areaHeight;\n      row++, nowCopyedCellsRow++\n    ) {\n      const td = tdMap[row][startPoint.col];\n      const insertTds: any[] = [];\n      copyedCells.forEach((td) => {\n        const path = td[1];\n        if (path[path.length - 2] === nowCopyedCellsRow) {\n          insertTds.push({\n            ...td[0],\n            selected: false,\n            start: false,\n            canTdEdit: false,\n          });\n        }\n      });\n      insertTds.length > 0 &&\n        Transforms.insertNodes(editor, _.cloneDeep(insertTds), {\n          at: [...tbody[1], row, td.originCol],\n        });\n    }\n\n    TdLogic.deselectAllTd(editor);\n    TableLogic.resetSelectedTds(editor);\n  },\n};\n","import escapeHtml from \"escape-html\";\nimport _ from \"lodash\";\nimport { Element, Text, Node, Editor } from \"slate\";\nimport {\n  CET,\n  EditorType,\n  Marks,\n  CustomElement,\n  CustomText,\n} from \"../common/Defines\";\n\ndeclare module \"slate\" {\n  interface CustomTypes {\n    Editor: EditorType;\n    Element: CustomElement;\n    Text: CustomText;\n  }\n}\n\nconst getStyle = (node: Node) => {\n  const style: any = {};\n  if (Text.isText(node) || Element.isElement(node)) {\n    for (const key of Object.values(Marks)) {\n      if (\n        [Marks.LineThrough, Marks.Underline].includes(key) &&\n        node[key] === true\n      ) {\n        style.textDecoration = (style.textDecoration || \"\") + `${key} `;\n        continue;\n      }\n      if (key === Marks.BOLD && node[key] === true) {\n        style.fontWeight = key;\n        continue;\n      }\n      if (key === Marks.ITALIC && node[key] === true) {\n        style.fontStyle = key;\n        continue;\n      }\n      if (\n        [Marks.FontSize, Marks.BGColor, Marks.Color, Marks.TextAlign].includes(\n          key\n        ) &&\n        node[key] != null\n      ) {\n        style[key] = node[key];\n        continue;\n      }\n    }\n    // li\n    if (node.type === CET.LIST_ITEM && node.liColor != null) {\n      style.color = node.liColor;\n    }\n    // td\n    if (node.type === CET.TD) {\n      if (node.width != null) {\n        style.maxWidth = style.minWidth = style.width = node.width + \"px\";\n      }\n      if (node.height != null) {\n        style.height = node.height + \"px\";\n      }\n      style.padding = \"4px\";\n    }\n    // table\n    if (node.type === CET.TABLE) {\n      style.borderCollapse = \"collapse\";\n    }\n  }\n  return _.map(style, (value, key) => {\n    return (\n      key.replace(/^([a-z]+)([A-Z])([a-z]+)$/g, \"$1-$2$3\").toLocaleLowerCase() +\n      \":\" +\n      value\n    );\n  }).join(\";\");\n};\n\nconst getAttributes = (node: Node) => {\n  let attrs = ``;\n  if (Element.isElement(node)) {\n    if (node.colSpan) {\n      attrs = attrs + `colspan=${node.colSpan} `;\n    }\n    if (node.rowSpan) {\n      attrs = attrs + `rowspan=${node.rowSpan} `;\n    }\n    if (node.url) {\n      attrs = attrs + `${node.type === CET.LINK ? \"href\" : \"src\"}=${node.url} `;\n    }\n    if(node.width){\n      attrs = attrs + `width=\"${node.width}px\" `;\n    }\n    if(node.height){\n      attrs = attrs + `height=\"${node.height}px\" `;\n    }\n  }\n  return attrs.trim();\n};\n\nexport const slateToHtml = (node: Node): string => {\n  if (Editor.isEditor(node)) {\n    const children = node.children.map((n) => slateToHtml(n)).join(\"\");\n    return `<html>\n      <style>\n      body{\n        font-family: \"Chinese Quote\", \"Segoe UI\", Roboto, \"PingFang SC\",\n    \"Hiragino Sans GB\", \"Microsoft YaHei\", \"Helvetica Neue\", Helvetica, Arial,\n    sans-serif;\n    font-size:14px;\n    line-height: 1.5715;\n    }\n    *, *::before, *::after{\n      box-sizing:border-box;\n    }\n    table{\n      border-collapse: collapse;\n    }\n    h1,h2,h3,h4{\n      margin-bottom:0;\n    }\n    ul,ol{\n      margin-bottom:0;\n    }\n    td{\n      overflow:hidden;\n    }\n      </style>\n      <body>${children}</body>\n    </html>`;\n  }\n\n  let style = getStyle(node);\n  style = style === \"\" ? \"\" : `style=\"${style}\"`;\n\n  if (Text.isText(node)) {\n    let string = escapeHtml(node.text);\n    string = `<span ${style}>${string}</span>`;\n    return string;\n  }\n\n  if (!Element.isElement(node)) return \"\";\n\n  const children = node.children.map((n) => slateToHtml(n)).join(\"\");\n\n  const attrs = getAttributes(node);\n\n  switch (node.type) {\n    case CET.NUMBER_LIST:\n      return `<ol ${attrs} ${style}>${children}</ol>`;\n    case CET.NORMAL_LIST:\n      return `<ul ${attrs} ${style}>${children}</ul>`;\n    case CET.LIST_ITEM:\n      return `<li ${attrs} ${style}>${children}</li>`;\n    case CET.DIV:\n      return `<div ${attrs} ${style}>${children}</div>`;\n    case CET.H1:\n      return `<h1 ${attrs} ${style}>${children}</h1>`;\n    case CET.H2:\n      return `<h2 ${attrs} ${style}>${children}</h2>`;\n    case CET.H3:\n      return `<h3 ${attrs} ${style}>${children}</h3>`;\n    case CET.H4:\n      return `<h4 ${attrs} ${style}>${children}</h4>`;\n    case CET.IMG:\n      return `<img ${attrs} src=\"${node.url}\" />`;\n    case CET.LINK:\n      return `<a ${attrs} href=\"${node.url}\">${children}</a>`;\n    case CET.TABLE:\n      return `<table border=\"1\" ${attrs} ${style}>${children}</table>`;\n    case CET.TBODY:\n      return `<tbody ${attrs} ${style}>${children}</tbody>`;\n    case CET.TR:\n      return `<tr ${attrs} ${style}>${children}</tr>`;\n    case CET.TD:\n      return `<td ${attrs} ${style}>${children}</td>`;\n    default:\n      return children;\n  }\n};\n","import { jsx } from \"slate-hyperscript\";\nimport { CET, Marks } from \"./Defines\";\n\nconst deserialize = (el: any): any => {\n  if (el.nodeType === 3) {\n    return el.textContent;\n  } else if (el.nodeType !== 1) {\n    return null;\n  }\n\n  const nodeStyle: Partial<\n    {\n      [key in Marks]: any;\n    } & {\n      width: number;\n      height: number;\n    }\n  > = {};\n  el.style?.cssText\n    ?.split(\";\")\n    // eslint-disable-next-line array-callback-return\n    .forEach((style: string) => {\n      const [key, value] = style.split(\":\");\n      if (!key) return null;\n      const changeKey = key\n        .trim()\n        .replace(/^([a-z]+)-([a-z])([a-z]+)$/gi, ($0, $1, $2, $3) => {\n          return $1 + $2.toUpperCase() + $3;\n        });\n      const changeValue = value.trim();\n      if (changeKey === \"textDecoration\") {\n        if (changeValue.includes(\"underline\")) {\n          nodeStyle[Marks.Underline] = true;\n        }\n        if (changeValue.includes(\"line-through\")) {\n          nodeStyle[Marks.LineThrough] = true;\n        }\n      } else if (changeValue === \"bold\") {\n        nodeStyle[Marks.BOLD] = true;\n      } else if (changeValue === \"italic\") {\n        nodeStyle[Marks.ITALIC] = true;\n      } else if (Object.values(Marks).includes(changeKey as Marks)) {\n        nodeStyle[changeKey as Marks] = changeValue;\n      }\n\n      if (changeKey === \"width\") {\n        nodeStyle.width = parseInt(changeValue);\n      }\n      if (changeKey === \"height\") {\n        nodeStyle.height = parseInt(changeValue);\n      }\n    });\n\n  let children = Array.from(el.childNodes).map(deserialize);\n\n  if (children.length === 0) {\n    children = [{ text: \"\" }];\n  }\n  switch (el.nodeName) {\n    case \"BR\":\n      return \"\\n\";\n    case \"BODY\":\n      return jsx(\"fragment\", {}, children);\n    case \"P\":\n    case \"DIV\": {\n      const isTextWrapper = (Array.from(el?.childNodes) || []).every(\n        (node: any) => node.nodeType === 3\n      );\n      return jsx(\n        \"element\",\n        { type: isTextWrapper ? CET.DIV : CET.Block, ...nodeStyle },\n        children\n      );\n    }\n    case \"H1\":\n      return jsx(\"element\", { type: CET.H1, ...nodeStyle }, children);\n    case \"H2\":\n      return jsx(\"element\", { type: CET.H2, ...nodeStyle }, children);\n    case \"H3\":\n      return jsx(\"element\", { type: CET.H3, ...nodeStyle }, children);\n    case \"H4\":\n      return jsx(\"element\", { type: CET.H4, ...nodeStyle }, children);\n    case \"A\":\n      return jsx(\n        \"element\",\n        { type: CET.LINK, url: el.getAttribute(\"href\"), ...nodeStyle },\n        children\n      );\n    case \"IMG\":\n      return jsx(\n        \"element\",\n        { type: CET.IMG, url: el.getAttribute(\"src\"), ...nodeStyle },\n        children\n      );\n    case \"UL\":\n      return jsx(\"element\", { type: CET.NORMAL_LIST, ...nodeStyle }, children);\n    case \"OL\":\n      return jsx(\"element\", { type: CET.NUMBER_LIST, ...nodeStyle }, children);\n    case \"LI\":\n      return jsx(\"element\", { type: CET.LIST_ITEM, ...nodeStyle }, children);\n    case \"TABLE\":\n      return jsx(\"element\", { type: CET.TABLE, ...nodeStyle }, children);\n    case \"TBODY\":\n      return jsx(\"element\", { type: CET.TBODY, ...nodeStyle }, children);\n    case \"TR\":\n      return jsx(\"element\", { type: CET.TR, ...nodeStyle }, children);\n    case \"TD\":\n      return jsx(\n        \"element\",\n        {\n          type: CET.TD,\n          ...nodeStyle,\n          rowSpan: el.getAttribute(\"rowspan\") || 1,\n          colSpan: el.getAttribute(\"colspan\") || 1,\n        },\n        children\n      );\n    default:\n      return el.textContent;\n  }\n};\n\nexport const htmlToSlate = (html: string): any => {\n  // 去掉标签之间的空格和回车等其他符号\n  const document = new DOMParser().parseFromString(html, \"text/html\");\n  return deserialize(document.body);\n};\n","/* eslint-disable react-hooks/exhaustive-deps */\n/* eslint-disable @typescript-eslint/no-unused-vars */\n/* eslint-disable eqeqeq */\nimport {\n  Col,\n  Button as AntButton,\n  Dropdown,\n  Tooltip,\n  Popover,\n  Row,\n  Select,\n  Divider,\n} from \"antd\";\nimport { Editor, Transforms, Element, Range, Text } from \"slate\";\nimport { ReactEditor, useSlate, useSlateStatic } from \"slate-react\";\nimport { CET, EditorType, Marks } from \"../common/Defines\";\nimport { ListLogic } from \"./ListComp\";\nimport { TableLogic } from \"../comps/Table\";\nimport { utils } from \"../common/utils\";\nimport _ from \"lodash\";\nimport { TdLogic, tdMinHeight } from \"./Td\";\nimport Icon, {\n  BgColorsOutlined,\n  BoldOutlined,\n  SaveOutlined,\n  ClearOutlined,\n  DeleteColumnOutlined,\n  DeleteOutlined,\n  DeleteRowOutlined,\n  FontColorsOutlined,\n  InsertRowAboveOutlined,\n  InsertRowBelowOutlined,\n  InsertRowLeftOutlined,\n  InsertRowRightOutlined,\n  ItalicOutlined,\n  LinkOutlined,\n  MergeCellsOutlined,\n  OrderedListOutlined,\n  PictureOutlined,\n  SplitCellsOutlined,\n  StrikethroughOutlined,\n  TableOutlined,\n  UnderlineOutlined,\n  UnorderedListOutlined,\n  VerticalAlignBottomOutlined,\n  VerticalAlignTopOutlined,\n  FolderOpenOutlined,\n  FormatPainterOutlined,\n} from \"@ant-design/icons\";\nimport \"./ToolBar.css\";\nimport React, { useContext, useMemo, useRef, useState } from \"react\";\nimport { CompactPicker } from \"react-color\";\nimport { EditorContext } from \"../RichEditor\";\nimport { useEffect } from \"react\";\nimport { slateToHtml } from \"../common/slateToHtml\";\nimport { htmlToSlate } from \"../common/htmlToSlate\";\n\nconst calcStatusDelay = 50;\n\nconst isSelectTd = (editor: EditorType) => {\n  const hasSelectedTd = TableLogic.getFirstSelectedTd(editor);\n  return hasSelectedTd == null;\n};\n\nexport const cleanFormat = (editor: EditorType) => {\n  const tds = TableLogic.getSelectedTds(editor);\n  if (tds.length > 0) {\n    for (const td of tds) {\n      Transforms.unsetNodes(editor, Object.values(Marks), { at: td[1] });\n    }\n    return;\n  }\n\n  const all = Editor.nodes(editor, {\n    mode: \"lowest\",\n    match(n) {\n      return utils.isTextWrapper(n) || Text.isText(n);\n    },\n  });\n  for (const el of all) {\n    Transforms.unsetNodes(editor, Object.values(Marks), { at: el[1] });\n  }\n};\n\nconst ColorPicker: React.FC<{\n  title: string;\n  onChange?: (color?: string) => void;\n  icon?: any;\n  mark: Marks;\n}> = (props) => {\n  const editor = useSlate();\n  const [color, setColor] = useState(\"\");\n  const [visible, setVisible] = useState(false);\n  const ref = useRef<any>({\n    _getColor: _.debounce(() => {\n      setColor(getColor());\n    }, calcStatusDelay),\n  });\n\n  const getColor = () => {\n    const td = TableLogic.getFirstSelectedTd(editor);\n    if (td) {\n      return Element.isElement(td[0]) && (td[0][props.mark] || \"unset\");\n    }\n\n    if (!editor.selection) return \"unset\";\n    if (!props.mark) return \"unset\";\n    const marks = Editor.marks(editor);\n    return (\n      (marks && marks?.[props?.mark]) ||\n      window.getComputedStyle(document.body).color\n    );\n  };\n\n  useEffect(() => {\n    ref.current._getColor();\n  });\n\n  return useMemo(() => {\n    return (\n      <Tooltip\n        title={props.title}\n        zIndex={99}\n        mouseLeaveDelay={0}\n        mouseEnterDelay={0}\n      >\n        <div\n          onMouseLeave={() => {\n            setVisible(false);\n          }}\n        >\n          <Dropdown\n            placement=\"bottomCenter\"\n            overlayStyle={{ zIndex: 999 }}\n            visible={visible}\n            overlay={() => {\n              return (\n                <ColorPickerCore\n                  value={color}\n                  onChange={(color) => {\n                    props?.onChange?.(color);\n                    setVisible(false);\n                  }}\n                ></ColorPickerCore>\n              );\n            }}\n            trigger={[\"click\"]}\n            getPopupContainer={(triggerNode) =>\n              triggerNode.parentElement || document.body\n            }\n          >\n            <AntButton\n              type=\"text\"\n              style={{ color }}\n              onMouseDown={(e) => {\n                e.preventDefault();\n                setVisible(true);\n              }}\n            >\n              {props.icon}\n            </AntButton>\n          </Dropdown>\n        </div>\n      </Tooltip>\n    );\n  }, [color, visible]);\n};\n\nconst ColorPickerCore: React.FC<{\n  value: string;\n  onChange?: (color?: string) => void;\n}> = (props) => {\n  const [color, setColor] = useState<{ hex: any }>({\n    hex: props.value,\n  });\n\n  return (\n    <div\n      style={{\n        padding: 8,\n        display: \"flex\",\n        justifyContent: \"flex-start\",\n        backgroundColor: \"white\",\n        flexDirection: \"column\",\n      }}\n      className=\"cyEditor__toolbar__colorPanelWrapper\"\n    >\n      <CompactPicker\n        color={color.hex}\n        onChange={(color) => {\n          setColor(color);\n          props?.onChange?.(color.hex);\n        }}\n      ></CompactPicker>\n      <AntButton\n        icon={<DeleteOutlined></DeleteOutlined>}\n        size=\"small\"\n        onClick={() => {\n          props?.onChange?.(\"unset\");\n          setColor({ hex: \"\" });\n        }}\n      >\n        重置\n      </AntButton>\n    </div>\n  );\n};\n\nconst getMarkValue = (editor: EditorType, mark: Marks) => {\n  try {\n    const td = TableLogic.getFirstSelectedTd(editor);\n    if (td && Element.isElement(td[0])) {\n      return td[0][mark];\n    }\n    if (!editor.selection) return null;\n    const marks = Editor.marks(editor);\n    return marks?.[mark];\n  } catch (error) {\n    console.error(error);\n    return false;\n  }\n};\n\nconst isMarkActive = (editor: EditorType, mark: Marks) => {\n  try {\n    const td = TableLogic.getFirstSelectedTd(editor);\n    if (td && Element.isElement(td[0])) {\n      return td[0][mark];\n    }\n\n    if (!editor.selection) return null;\n    const marks = Editor.marks(editor);\n    return marks?.[mark] === true ? true : false;\n  } catch (error) {\n    console.error(error);\n    return false;\n  }\n};\n\nconst ValueSelector = (props: {\n  options: (string | number)[];\n  optionLabelRender?: (value: string | number) => any;\n  title: string;\n  getValue: (editor: EditorType) => any;\n  afterSelect?: (value: string | number) => void;\n}) => {\n  const editor = useSlate();\n  const [visible, setVisible] = useState(false);\n  const [value, setValue] = useState(\"\");\n  const toolDom = useRef<any>();\n  const ref = useRef<any>({\n    getValue: _.debounce(() => {\n      setValue(props.getValue(editor));\n    }, calcStatusDelay),\n  });\n\n  useEffect(() => {\n    ref.current.getValue();\n  });\n  return useMemo(() => {\n    return (\n      <Tooltip\n        title={props.title}\n        zIndex={99}\n        mouseEnterDelay={0}\n        mouseLeaveDelay={0}\n      >\n        <div\n          ref={toolDom}\n          style={{\n            width: 100,\n            position: \"relative\",\n          }}\n          className=\"cyEditor__toolbar__button\"\n          onMouseLeave={() => {\n            setVisible(false);\n          }}\n        >\n          <div\n            style={{\n              width: \"100%\",\n              height: \"100%\",\n              position: \"absolute\",\n              top: 0,\n              left: 0,\n              zIndex: 1,\n              cursor: \"pointer\",\n            }}\n            onMouseDown={(e) => {\n              e.preventDefault();\n              setVisible(!visible);\n            }}\n          ></div>\n          <Select\n            placeholder={props.title}\n            value={value}\n            bordered={false}\n            style={{ width: \"100%\" }}\n            open={visible}\n            dropdownClassName=\"cyEditor__toolbar__dropdown\"\n            getPopupContainer={(triggerNode) =>\n              triggerNode.parentElement || document.body\n            }\n            onSelect={(value) => {\n              ReactEditor.focus(editor);\n              props?.afterSelect?.(value);\n              setVisible(false);\n            }}\n          >\n            {props.options.map((value) => {\n              return (\n                <Select.Option value={String(value)} key={value}>\n                  {props?.optionLabelRender?.(value) || value}\n                </Select.Option>\n              );\n            })}\n          </Select>\n        </div>\n      </Tooltip>\n    );\n  }, [visible, value]);\n};\n\nconst MarkButton: React.FC<{\n  title: string;\n  mark?: Marks;\n}> = (props) => {\n  const editor = useSlate();\n  const [type, setType] = useState(\"text\");\n  const ref = useRef<any>({\n    getType: _.debounce(() => {\n      setType(props.mark && isMarkActive(editor, props.mark) ? \"link\" : \"text\");\n    }, calcStatusDelay),\n  });\n\n  useEffect(() => {\n    ref.current.getType();\n  });\n\n  const toggleMark = (mark: Marks) => {\n    // 针对选中表格的情况\n    const tds = TableLogic.getSelectedTds(editor);\n\n    if (tds.length > 0) {\n      ReactEditor.focus(editor);\n      tds.forEach((td) => {\n        if (!Element.isElement(td[0])) return;\n        if (td[0][mark]) {\n          Transforms.unsetNodes(editor, [mark], { at: td[1] });\n        } else {\n          Transforms.setNodes(editor, { [mark]: true }, { at: td[1] });\n        }\n      });\n      return;\n    }\n\n    if (!editor.selection) return;\n\n    const marks = Editor.marks(editor);\n\n    if (marks?.[mark]) {\n      Editor.removeMark(editor, mark);\n    } else {\n      Editor.addMark(editor, mark, true);\n    }\n  };\n\n  return useMemo(() => {\n    return (\n      <Tooltip title={props.title} mouseEnterDelay={0} mouseLeaveDelay={0}>\n        <AntButton\n          className=\"cyEditor__toolbar__button\"\n          type={type as any}\n          onMouseDown={(e) => {\n            e.preventDefault();\n            props.mark && toggleMark(props.mark);\n          }}\n        >\n          {props.children}\n        </AntButton>\n      </Tooltip>\n    );\n  }, [type]);\n};\n\nconst StaticButton: React.FC<{\n  title: string;\n  mousedownFunc: (e: any) => void;\n  disabled?: boolean;\n}> = (props) => {\n  return (\n    <Tooltip title={props.title} mouseEnterDelay={0} mouseLeaveDelay={0}>\n      <AntButton\n        className=\"cyEditor__toolbar__button\"\n        type={\"text\"}\n        disabled={props.disabled}\n        onMouseDown={(e) => {\n          e.preventDefault();\n          props.mousedownFunc(e);\n        }}\n      >\n        {props.children}\n      </AntButton>\n    </Tooltip>\n  );\n};\n\nconst ReactButton: React.FC<{\n  title: string;\n  mousedownFunc: (e: any) => void;\n  disabledCondition?: (editor: EditorType) => boolean;\n}> = (props) => {\n  const editor = useSlate();\n  const { mousedownFunc, title, disabledCondition = () => false } = props;\n  const [disabled, setDisabled] = useState(false);\n  const ref = useRef({\n    _isDisabled: _.debounce(() => {\n      setDisabled(disabledCondition(editor));\n    }, calcStatusDelay),\n  });\n  useEffect(() => {\n    ref.current._isDisabled();\n  });\n  return (\n    <Tooltip title={title} mouseEnterDelay={0} mouseLeaveDelay={0}>\n      <AntButton\n        className=\"cyEditor__toolbar__button\"\n        type={\"text\"}\n        disabled={disabled}\n        onMouseDown={(e) => {\n          e.preventDefault();\n          mousedownFunc(e);\n        }}\n      >\n        {props.children}\n      </AntButton>\n    </Tooltip>\n  );\n};\n\nconst CopyFormat: React.FC<{}> = (props) => {\n  const editor = useSlate();\n  const { setSavedMarks } = useContext(EditorContext);\n  const [disabled, setDisabled] = useState(false);\n  const ref = useRef<any>({\n    isDisabled: _.debounce(() => {\n      const isNotOnlyOne = TableLogic.getSelectedTdsSize(editor) > 1;\n      const td = TableLogic.getFirstSelectedTd(editor);\n      setDisabled(!(editor.selection != null || (td && !isNotOnlyOne)));\n    }, calcStatusDelay),\n  });\n\n  useEffect(() => {\n    ref.current.isDisabled();\n  });\n\n  const copyMark = () => {\n    try {\n      const isNotOnlyOne = TableLogic.getSelectedTdsSize(editor) > 1;\n      const td = TableLogic.getFirstSelectedTd(editor);\n      if (td && !isNotOnlyOne && Element.isElement(td[0])) {\n        setSavedMarks(td[0] || null);\n        return;\n      }\n      if (!editor.selection) return null;\n      const marks = Editor.marks(editor);\n      const textWrapper = Editor.above(editor, {\n        mode: \"lowest\",\n        match(n) {\n          return utils.isTextWrapper(n);\n        },\n      });\n      if (textWrapper) setSavedMarks({ ...marks, ...textWrapper[0] } || null);\n      else setSavedMarks(marks || null);\n    } catch (error) {\n      console.warn(error);\n    }\n  };\n  return useMemo(() => {\n    return (\n      <StaticButton\n        title=\"格式刷\"\n        disabled={disabled}\n        mousedownFunc={() => {\n          copyMark();\n        }}\n      >\n        <FormatPainterOutlined />\n      </StaticButton>\n    );\n  }, [disabled]);\n};\n\nconst InsertTableButton: React.FC<{\n  title: string;\n  onChange?: (color?: string) => void;\n  icon?: any;\n}> = (props) => {\n  const editor = useSlate();\n  const [visible, setVisible] = useState(false);\n  const [counts, setCounts] = useState<string>(\"\");\n  const tableDom = useRef<any>();\n  const [disabled, setDisabled] = useState(false);\n  const ref = useRef({\n    _isDisabled: _.debounce(() => {\n      setDisabled(editor.selection == null);\n    }, calcStatusDelay),\n  });\n  useEffect(() => {\n    ref.current._isDisabled();\n  });\n\n  const rowCount = 10,\n    cellCount = 10;\n\n  const tdMouseEnter = (e: any) => {\n    const table: any = tableDom.current;\n    const td = e.target;\n    const tr = e.target.parentNode;\n    if (!table || !td || !tr) return;\n\n    Array.from(table.querySelectorAll(\"td\")).forEach((td: any) => {\n      td.style.backgroundColor = \"unset\";\n    });\n    const trs = Array.from(table.querySelectorAll(\"tr\"));\n\n    for (let i = 0; i <= tr.rowIndex; i++) {\n      const nowTr: any = trs[i];\n      const tds: any = Array.from(nowTr.querySelectorAll(\"td\"));\n      for (let j = 0; j <= td.cellIndex; j++) {\n        const nowTd = tds[j];\n        nowTd.style.backgroundColor = \"rgba(180,215,255,.7)\";\n      }\n    }\n\n    setCounts(`${td.cellIndex + 1}x${tr.rowIndex + 1}`);\n  };\n\n  const addTable = () => {\n    const cellCount = Number(counts.split(\"x\")[0]);\n    const rowCount = Number(counts.split(\"x\")[1]);\n    if (!Number.isInteger(cellCount) || !Number.isInteger(rowCount)) return;\n\n    ReactEditor.focus(editor);\n\n    if (!editor.selection) return;\n\n    const [tw] = Editor.nodes(editor, {\n      mode: \"lowest\",\n      match(n) {\n        return utils.isTextWrapper(n);\n      },\n    });\n    if (!tw) return;\n    const twDom = ReactEditor.toDOMNode(editor, tw[0]);\n    const parent: any = twDom.offsetParent;\n    if (!parent) return;\n    const tableWrapperWidth = twDom.offsetWidth - 2;\n\n    Transforms.insertNodes(editor, {\n      type: CET.TABLE,\n      wrapperWidthWhenCreated: tableWrapperWidth,\n      children: [\n        {\n          type: CET.TBODY,\n          children: new Array(rowCount).fill(\"0\").map(() => {\n            return {\n              type: CET.TR,\n              children: new Array(cellCount).fill(\"0\").map(() => {\n                return {\n                  type: CET.TD,\n                  width: tableWrapperWidth / cellCount,\n                  height: tdMinHeight,\n                  children: [\n                    {\n                      type: CET.DIV,\n                      children: [{ text: \"\" }],\n                    },\n                  ],\n                };\n              }),\n            };\n          }),\n        },\n      ],\n    });\n\n    Transforms.deselect(editor);\n    setVisible(false);\n  };\n\n  return useMemo(() => {\n    return (\n      <div\n        onMouseLeave={() => {\n          setVisible(false);\n        }}\n      >\n        <Dropdown\n          placement=\"bottomCenter\"\n          overlayStyle={{ zIndex: 999 }}\n          visible={visible}\n          overlay={() => {\n            return (\n              <div\n                className=\"cyEditor__toolbar__tablePanelWrapper\"\n                style={{\n                  width: 200,\n                  padding: 8,\n                  display: \"flex\",\n                  justifyContent: \"flex-start\",\n                  backgroundColor: \"white\",\n                  flexDirection: \"column\",\n                }}\n              >\n                {visible ? (\n                  <table border=\"1\" ref={tableDom}>\n                    <tbody>\n                      {new Array(rowCount).fill(0).map((item, index) => {\n                        return (\n                          <tr key={index}>\n                            {new Array(cellCount).fill(0).map((item, index) => {\n                              return (\n                                <td\n                                  key={index}\n                                  onMouseEnter={tdMouseEnter}\n                                  onClick={addTable}\n                                ></td>\n                              );\n                            })}\n                          </tr>\n                        );\n                      })}\n                    </tbody>\n                  </table>\n                ) : null}\n                <div style={{ textAlign: \"right\" }}>{counts}</div>\n              </div>\n            );\n          }}\n          trigger={[\"click\"]}\n          getPopupContainer={(triggerNode) =>\n            triggerNode.parentElement || document.body\n          }\n        >\n          <Tooltip\n            title={props.title}\n            zIndex={99}\n            mouseLeaveDelay={0}\n            mouseEnterDelay={0}\n          >\n            <AntButton\n              type=\"text\"\n              onMouseDown={(e) => {\n                e.preventDefault();\n                setVisible(true);\n              }}\n              disabled={disabled}\n            >\n              {props.icon}\n            </AntButton>\n          </Tooltip>\n        </Dropdown>\n      </div>\n    );\n  }, [visible, disabled, counts]);\n};\n\nconst ReadOnlyButton: React.FC<{}> = (props) => {\n  const { readOnly, setReadOnly } = useContext(EditorContext);\n  const title = readOnly ? \"编辑模式\" : \"只读模式\";\n  return (\n    <StaticButton\n      title={title}\n      mousedownFunc={() => {\n        setReadOnly(!readOnly);\n      }}\n    >\n      {title}\n    </StaticButton>\n  );\n};\n\nexport const ToolBar: React.FC<{}> = (props) => {\n  const editor = useSlateStatic();\n\n  const setNumberList = () => {\n    ListLogic.toggleList(editor, CET.NUMBER_LIST);\n  };\n\n  const setNormalList = () => {\n    ListLogic.toggleList(editor, CET.NORMAL_LIST);\n  };\n\n  const setTextWrapper = (type: CET) => {\n    const tds = TableLogic.getSelectedTds(editor);\n    if (tds.length > 0) {\n      tds.forEach((td) => {\n        Transforms.setNodes(\n          editor,\n          {\n            type,\n          },\n          {\n            at: td[1],\n            match(n) {\n              return utils.isTextWrapper(n);\n            },\n          }\n        );\n      });\n    } else {\n      Transforms.setNodes(\n        editor,\n        { type: type },\n        {\n          hanging: true,\n          mode: \"lowest\",\n          match(n) {\n            return utils.isTextWrapper(n);\n          },\n        }\n      );\n    }\n  };\n\n  const setLink = () => {\n    const [isLinkActive] = Editor.nodes(editor, {\n      match(n) {\n        return Element.isElement(n) && n.type == CET.LINK;\n      },\n    });\n    if (!isLinkActive) {\n      Transforms.wrapNodes(\n        editor,\n        {\n          type: CET.LINK,\n          url: \"http://www.baidu.com\",\n          children: [],\n        },\n        {\n          split: true,\n        }\n      );\n    }\n  };\n\n  const insertImg = () => {\n    if (editor.selection && Range.isExpanded(editor.selection)) {\n      Transforms.collapse(editor, { edge: \"end\" });\n    }\n    Transforms.insertNodes(editor, {\n      type: CET.IMG,\n      children: [\n        {\n          text: \"\",\n        },\n      ],\n    });\n    Transforms.move(editor);\n  };\n\n  const insertDivAfterTable = () => {\n    TableLogic.insertDivAfterTable(editor);\n  };\n\n  const insertDivBeforeTable = () => {\n    TableLogic.insertDivBeforeTable(editor);\n  };\n\n  const deleteTable = () => {\n    TableLogic.deleteTable(editor);\n  };\n\n  const mergeTd = () => {\n    TableLogic.mergeTd(editor);\n  };\n\n  const splitTd = () => {\n    TableLogic.splitTd(editor);\n  };\n\n  const insertRowAfter = () => {\n    TableLogic.insertRow(editor, \"after\");\n  };\n\n  const insertRowBefore = () => {\n    TableLogic.insertRow(editor, \"before\");\n  };\n\n  const insertColumnAfter = () => {\n    TableLogic.insertColumn(editor, \"after\");\n  };\n\n  const insertColumnBefore = () => {\n    TableLogic.insertColumn(editor, \"before\");\n  };\n\n  const deleteColumn = () => {\n    TableLogic.deleteColumn(editor);\n  };\n\n  const deleteRow = () => {\n    TableLogic.deleteRow(editor);\n  };\n\n  const clearTd = () => {\n    TdLogic.clearTd(editor);\n  };\n\n  return (\n    <div\n      className=\"cyEditor__toolBar\"\n      style={{ position: \"relative\", marginBottom: 4 }}\n    >\n      <Row align=\"middle\">\n        {/* 设置字体规格 */}\n        <Col>\n          <ValueSelector\n            getValue={(editor: EditorType) => {\n              const [node] = Editor.nodes(editor, {\n                match(n) {\n                  return utils.isTextWrapper(n);\n                },\n              });\n              if (!node) return \"正文\";\n              const type = Element.isElement(node[0]) && node[0].type;\n              return type == \"div\" || type == false\n                ? \"正文\"\n                : type.toUpperCase();\n            }}\n            options={[\"H1\", \"H2\", \"H3\", \"H4\", \"正文\"]}\n            optionLabelRender={(value) => {\n              return <span>{value}</span>;\n            }}\n            title=\"字体样式\"\n            afterSelect={(value) => {\n              if (value == \"H1\") setTextWrapper(CET.H1);\n              if (value == \"H2\") setTextWrapper(CET.H2);\n              if (value == \"H3\") setTextWrapper(CET.H3);\n              if (value == \"H4\") setTextWrapper(CET.H4);\n              if (value == \"正文\") setTextWrapper(CET.DIV);\n            }}\n          ></ValueSelector>\n        </Col>\n        {/* 设置字体大小 */}\n        <Col>\n          <ValueSelector\n            getValue={(editor) => {\n              return String(getMarkValue(editor, Marks.FontSize) || 14);\n            }}\n            options={[12, 13, 14, 15, 16, 19, 22, 24, 29, 32, 40, 48]}\n            optionLabelRender={(value) => {\n              return `${value}px`;\n            }}\n            title=\"字体大小\"\n            afterSelect={(value) => {\n              const tds = TableLogic.getSelectedTds(editor);\n              if (tds.length > 0) {\n                for (const td of tds) {\n                  Transforms.setNodes(\n                    editor,\n                    {\n                      [Marks.FontSize]: Number(value),\n                    },\n                    {\n                      at: td[1],\n                    }\n                  );\n                }\n                return;\n              }\n              if (!editor.selection) return;\n              Editor.addMark(editor, Marks.FontSize, Number(value));\n            }}\n          ></ValueSelector>\n        </Col>\n        {/* 设置对齐方式 */}\n        <Col>\n          <ValueSelector\n            getValue={(editor) => {\n              const td = TableLogic.getFirstSelectedTd(editor);\n              if (td && Element.isElement(td[0])) {\n                return td[0][Marks.TextAlign] || \"左对齐\";\n              }\n\n              const [node] = Editor.nodes(editor, {\n                match(n) {\n                  return utils.isTextWrapper(n);\n                },\n              });\n              if (!node) return \"左对齐\";\n              const textAlign = Element.isElement(node[0]) && node[0].textAlign;\n              return textAlign == false || textAlign == null\n                ? \"left\"\n                : textAlign;\n            }}\n            options={[\"left\", \"right\", \"center\"]}\n            optionLabelRender={(value) => {\n              if (value == \"left\") return \"左对齐\";\n              if (value == \"right\") return \"右对齐\";\n              if (value == \"center\") return \"居中对齐\";\n              return `${value}`;\n            }}\n            title=\"对齐方式\"\n            afterSelect={(value) => {\n              ReactEditor.focus(editor);\n              const tds = TableLogic.getSelectedTds(editor);\n              if (tds.length > 0) {\n                for (const td of tds) {\n                  Transforms.setNodes(\n                    editor,\n                    { textAlign: value },\n                    {\n                      at: td[1],\n                    }\n                  );\n                }\n                return;\n              }\n              if (!editor.selection) return;\n              Transforms.setNodes(\n                editor,\n                { textAlign: value },\n                {\n                  mode: \"lowest\",\n                  match(n) {\n                    return utils.isTextWrapper(n);\n                  },\n                }\n              );\n            }}\n          ></ValueSelector>\n        </Col>\n        <Col>\n          <Divider\n            style={{ height: 20, backgroundColor: \"rgb(0 0 0 / 10%)\" }}\n            type=\"vertical\"\n          />\n        </Col>\n        <Col>\n          <CopyFormat></CopyFormat>\n        </Col>\n        <Col>\n          <StaticButton\n            title=\"清除格式\"\n            mousedownFunc={() => {\n              cleanFormat(editor);\n            }}\n          >\n            <Icon\n              component={() => (\n                <svg\n                  viewBox=\"0 0 1084 1024\"\n                  version=\"1.1\"\n                  xmlns=\"http://www.w3.org/2000/svg\"\n                  p-id=\"853\"\n                  width=\"14\"\n                  height=\"14\"\n                >\n                  <defs>\n                    <style type=\"text/css\"></style>\n                  </defs>\n                  <path\n                    d=\"M719.329882 422.249412l-255.578353 255.578353 234.315295 234.315294 255.518117-255.638588-234.315294-234.255059zM59.151059 315.813647l298.164706-298.164706a60.235294 60.235294 0 0 1 85.172706 0l596.329411 596.329412a60.235294 60.235294 0 0 1 0 85.172706l-298.164706 298.164706a60.235294 60.235294 0 0 1-85.232941 0l-596.329411-596.329412a60.235294 60.235294 0 0 1 0-85.172706z\"\n                    fill=\"#333333\"\n                    p-id=\"854\"\n                  ></path>\n                </svg>\n              )}\n            ></Icon>\n          </StaticButton>\n        </Col>\n        <Col>\n          <ColorPicker\n            title=\"字体颜色\"\n            onChange={(color) => {\n              ReactEditor.focus(editor);\n              const tds = TableLogic.getSelectedTds(editor);\n              if (tds.length > 0) {\n                for (const td of tds) {\n                  Transforms.setNodes(\n                    editor,\n                    {\n                      [Marks.Color]: color,\n                    },\n                    {\n                      at: td[1],\n                    }\n                  );\n                }\n                return;\n              }\n              if (!editor.selection) return;\n              Editor.addMark(editor, Marks.Color, color);\n            }}\n            mark={Marks.Color}\n            icon={<FontColorsOutlined />}\n          ></ColorPicker>\n        </Col>\n        <Col>\n          <ColorPicker\n            title=\"背景色\"\n            onChange={(color) => {\n              ReactEditor.focus(editor);\n              const tds = TableLogic.getSelectedTds(editor);\n              if (tds.length > 0) {\n                for (const td of tds) {\n                  Transforms.setNodes(\n                    editor,\n                    {\n                      [Marks.BGColor]: color,\n                    },\n                    {\n                      at: td[1],\n                    }\n                  );\n                }\n                return;\n              }\n              if (!editor.selection) return;\n              Editor.addMark(editor, Marks.BGColor, color);\n            }}\n            mark={Marks.BGColor}\n            icon={<BgColorsOutlined />}\n          ></ColorPicker>\n        </Col>\n        <Col>\n          <MarkButton title=\"加粗\" mark={Marks.BOLD}>\n            <BoldOutlined />\n          </MarkButton>\n        </Col>\n        <Col>\n          <MarkButton title=\"斜体\" mark={Marks.ITALIC}>\n            <ItalicOutlined />\n          </MarkButton>\n        </Col>\n        <Col>\n          <MarkButton title=\"下划线\" mark={Marks.Underline}>\n            <UnderlineOutlined />\n          </MarkButton>\n        </Col>\n        <Col>\n          <MarkButton title=\"删除线\" mark={Marks.LineThrough}>\n            <StrikethroughOutlined />\n          </MarkButton>\n        </Col>\n        <Col>\n          <Divider\n            style={{ height: 20, backgroundColor: \"rgb(0 0 0 / 10%)\" }}\n            type=\"vertical\"\n          />\n        </Col>\n        <Col>\n          <ReactButton\n            title=\"有序列表\"\n            mousedownFunc={() => {\n              setNumberList();\n            }}\n            disabledCondition={(editor) => {\n              return editor.selection == null;\n            }}\n          >\n            <OrderedListOutlined />\n          </ReactButton>\n        </Col>\n        <Col>\n          <ReactButton\n            title=\"无序列表\"\n            mousedownFunc={() => {\n              setNormalList();\n            }}\n            disabledCondition={(editor) => {\n              return editor.selection == null;\n            }}\n          >\n            <UnorderedListOutlined />\n          </ReactButton>\n        </Col>\n        <Col>\n          <ReactButton\n            title=\"设置链接\"\n            mousedownFunc={() => {\n              setLink();\n            }}\n            disabledCondition={(editor) => {\n              return editor.selection == null;\n            }}\n          >\n            <LinkOutlined />\n          </ReactButton>\n        </Col>\n        <Col>\n          <ReactButton\n            title=\"插入图片\"\n            mousedownFunc={() => {\n              insertImg();\n            }}\n            disabledCondition={(editor) => {\n              return editor.selection == null;\n            }}\n          >\n            <PictureOutlined />\n          </ReactButton>\n        </Col>\n        <Col>\n          <ReactButton\n            title=\"插入资源文件\"\n            mousedownFunc={() => {}}\n            disabledCondition={(editor) => {\n              return editor.selection == null;\n            }}\n          >\n            <FolderOpenOutlined />\n          </ReactButton>\n        </Col>\n        <Col>\n          <Divider\n            style={{ height: 20, backgroundColor: \"rgb(0 0 0 / 10%)\" }}\n            type=\"vertical\"\n          />\n        </Col>\n        <Col>\n          <InsertTableButton\n            title=\"表格\"\n            icon={<TableOutlined />}\n          ></InsertTableButton>\n        </Col>\n        <Col>\n          <ReactButton\n            title=\"删除表格\"\n            mousedownFunc={() => {\n              deleteTable();\n            }}\n            disabledCondition={isSelectTd}\n          >\n            <DeleteOutlined />\n          </ReactButton>\n        </Col>\n        <Col>\n          <ReactButton\n            title=\"删除列\"\n            mousedownFunc={() => {\n              deleteColumn();\n            }}\n            disabledCondition={isSelectTd}\n          >\n            <DeleteColumnOutlined />\n          </ReactButton>\n        </Col>\n        <Col>\n          <ReactButton\n            title=\"删除行\"\n            mousedownFunc={() => {\n              deleteRow();\n            }}\n            disabledCondition={isSelectTd}\n          >\n            <DeleteRowOutlined />\n          </ReactButton>\n        </Col>\n        <Col>\n          <ReactButton\n            title=\"表格后插入文本\"\n            mousedownFunc={() => {\n              insertDivAfterTable();\n            }}\n            disabledCondition={isSelectTd}\n          >\n            <VerticalAlignBottomOutlined />\n          </ReactButton>\n        </Col>\n        <Col>\n          <ReactButton\n            title=\"表格前插入文本\"\n            mousedownFunc={() => {\n              insertDivBeforeTable();\n            }}\n            disabledCondition={isSelectTd}\n          >\n            <VerticalAlignTopOutlined />\n          </ReactButton>\n        </Col>\n        <Col>\n          <ReactButton\n            title=\"左插入列\"\n            mousedownFunc={() => {\n              insertColumnBefore();\n            }}\n            disabledCondition={isSelectTd}\n          >\n            <InsertRowLeftOutlined />\n          </ReactButton>\n        </Col>\n        <Col>\n          <ReactButton\n            title=\"右插入列\"\n            mousedownFunc={() => {\n              insertColumnAfter();\n            }}\n            disabledCondition={isSelectTd}\n          >\n            <InsertRowRightOutlined />\n          </ReactButton>\n        </Col>\n        <Col>\n          <ReactButton\n            title=\"上插入行\"\n            mousedownFunc={() => {\n              insertRowBefore();\n            }}\n            disabledCondition={isSelectTd}\n          >\n            <InsertRowAboveOutlined />\n          </ReactButton>\n        </Col>\n        <Col>\n          <ReactButton\n            title=\"下插入行\"\n            mousedownFunc={() => {\n              insertRowAfter();\n            }}\n            disabledCondition={isSelectTd}\n          >\n            <InsertRowBelowOutlined />\n          </ReactButton>\n        </Col>\n        <Col>\n          <ReactButton\n            title=\"合并单元格\"\n            mousedownFunc={() => {\n              mergeTd();\n            }}\n            disabledCondition={isSelectTd}\n          >\n            <MergeCellsOutlined />\n          </ReactButton>\n        </Col>\n        <Col>\n          <ReactButton\n            title=\"拆分单元格\"\n            mousedownFunc={() => {\n              splitTd();\n            }}\n            disabledCondition={isSelectTd}\n          >\n            <SplitCellsOutlined />\n          </ReactButton>\n        </Col>\n        <Col>\n          <ReactButton\n            title=\"清空单元格\"\n            mousedownFunc={() => {\n              clearTd();\n            }}\n            disabledCondition={isSelectTd}\n          >\n            <ClearOutlined />\n          </ReactButton>\n        </Col>\n        <Col>\n          <Divider\n            style={{ height: 20, backgroundColor: \"rgb(0 0 0 / 10%)\" }}\n            type=\"vertical\"\n          />\n        </Col>\n        <Col>\n          <StaticButton\n            title=\"输出内容\"\n            mousedownFunc={() => {\n              console.log(JSON.stringify(editor.children));\n              window.localStorage.setItem(\n                \"savedContent\",\n                JSON.stringify(editor.children)\n              );\n            }}\n          >\n            <SaveOutlined />\n          </StaticButton>\n        </Col>\n        <Col>\n          <StaticButton\n            title=\"输出内容HTML\"\n            mousedownFunc={(e) => {\n              // const editorDom = e.nativeEvent.path.find((o: any) => o.className == \"cyEditor\");\n              // if(!editorDom) return;\n              // const content = editorDom.querySelector(':scope>.cyEditor__content');\n              // console.log(content.innerHTML);\n              console.log(slateToHtml(editor));\n            }}\n          >\n            slateToHtml\n          </StaticButton>\n        </Col>\n        <Col>\n          <StaticButton\n            title=\"输入内容\"\n            mousedownFunc={(e) => {\n              // const editorDom = e.nativeEvent.path.find((o: any) => o.className == \"cyEditor\");\n              // if(!editorDom) return;\n              // const content = editorDom.querySelector(':scope>.cyEditor__content');\n              // console.log(content.innerHTML);\n              const content = htmlToSlate(\n                `<table><tbody><tr><td>123</td></tr></tbody></table>`\n              );\n              Transforms.insertNodes(editor, content);\n            }}\n          >\n            htmlToSlate\n          </StaticButton>\n        </Col>\n        <Col>\n          <ReadOnlyButton></ReadOnlyButton>\n        </Col>\n      </Row>\n    </div>\n  );\n};\n","/* eslint-disable eqeqeq */\nimport { Range } from \"slate\";\nimport { EditorType } from \"../../common/Defines\";\nimport { handleSelectedTd } from \"./handleSelectedTd\";\nimport { handleRangeCollapsed } from \"./handleRangeCollapsed\";\nimport { handleRangeExpand } from \"./handleRangeExpand\";\nimport { getStrPathSetOfSelectedTds } from \"../../common/globalStore\";\n\nexport const HandleKeyDownEvent = (e: any, editor: EditorType) => {\n  const selectedTds = getStrPathSetOfSelectedTds(editor);\n\n  if (selectedTds.size > 0) {\n    handleSelectedTd(e, editor);\n    return;\n  }\n\n  const { selection } = editor;\n  if (!selection) return;\n\n  if (Range.isExpanded(selection)) {\n    return handleRangeExpand(e, editor);\n  }\n\n  if (Range.isCollapsed(selection)) {\n    return handleRangeCollapsed(e, editor);\n  }\n};\n","import { EditorType } from \"../../common/Defines\";\nimport { TdLogic } from \"../../comps/Td\";\nimport { TableLogic } from \"../../comps/Table\";\nimport { setCopyedContent } from \"../../common/globalStore\";\n\nexport const handleSelectedTd = (e: any, editor: EditorType) => {\n  // 当没有选区的时候，查看是否已经选中表格\n  const isNotOnlyOneTd = TableLogic.getSelectedTdsSize(editor) > 1;\n\n  const getFirstTd = () => TableLogic.getFirstSelectedTd(editor);\n\n  switch (e.key) {\n    case \"Delete\":\n    case \"Backspace\": {\n      TdLogic.clearTd(editor);\n      break;\n    }\n    case \"Tab\": {\n      e.preventDefault();\n      if (isNotOnlyOneTd) break;\n      const td = getFirstTd();\n      td && TdLogic.findTargetTd(editor, td, e.shiftKey ? \"left\" : \"right\");\n      break;\n    }\n    case \"Escape\": {\n      e.preventDefault();\n      TdLogic.deselectAllTd(editor);\n      break;\n    }\n    // 直接全选选中的td的内容，进入编辑状态\n    case \" \":\n    case \"Enter\":\n      {\n        e.preventDefault();\n        if (isNotOnlyOneTd) break;\n        const td = getFirstTd();\n        td && TdLogic.editTd(editor, td);\n      }\n      break;\n    case \"ArrowUp\": {\n      e.preventDefault();\n      if (isNotOnlyOneTd) break;\n      const td = getFirstTd();\n      td && TdLogic.findTargetTd(editor, td, \"up\");\n      break;\n    }\n    case \"ArrowDown\": {\n      e.preventDefault();\n      if (isNotOnlyOneTd) break;\n      const td = getFirstTd();\n      td && TdLogic.findTargetTd(editor, td, \"down\");\n      break;\n    }\n    case \"ArrowLeft\": {\n      e.preventDefault();\n      if (isNotOnlyOneTd) break;\n      const td = getFirstTd();\n      td && TdLogic.findTargetTd(editor, td, \"left\");\n      break;\n    }\n    case \"ArrowRight\": {\n      e.preventDefault();\n      if (isNotOnlyOneTd) break;\n      const td = getFirstTd();\n      td && TdLogic.findTargetTd(editor, td, \"right\");\n      break;\n    }\n  }\n\n  if (!e.ctrlKey && (e.key.length === 1 || e.key === \"Process\")) {\n    if (isNotOnlyOneTd) return;\n    const td = getFirstTd();\n    TdLogic.clearTd(editor);\n    td && TdLogic.editTd(editor, td);\n    return;\n  }\n\n  // 选中单元格进行复制\n  if (e.ctrlKey && e.key === \"c\") {\n    setCopyedContent(null);\n    TableLogic.copyCells(editor);\n    return;\n  }\n\n  // 粘贴单元格\n  if (e.ctrlKey && e.key === \"v\") {\n    TableLogic.pasteCells(editor);\n    return;\n  }\n\n  return;\n};\n","import { Editor } from \"slate\";\nimport { EditorType } from \"../../common/Defines\";\nimport { utils } from \"../../common/utils\";\nimport { ListLogic } from \"../../comps/ListComp\";\nimport { TableLogic } from \"../../comps/Table\";\nimport { TdLogic } from \"../../comps/Td\";\n\nexport const handleRangeExpand = (e: any, editor: EditorType):void => {\n  const { selection } = editor;\n  if (!selection) return;\n  \n  switch (e.key) {\n    case \"Escape\": {\n      const [td, isNotOnlyOne] = Editor.nodes(editor, {\n        at: selection,\n        match(n) {\n          return TableLogic.isTd(n) && n.canTdEdit === true;\n        },\n      });\n      if (!td || isNotOnlyOne) break;\n      TdLogic.chooseTd(editor, td);\n      break;\n    }\n    case \"Tab\": {\n      e.preventDefault();\n\n      for (const [, p] of Editor.nodes(editor, {\n        at: selection,\n        reverse: true,\n        universal: true,\n        match(n) {\n          return utils.isTextWrapper(n);\n        },\n      })) {\n        const [parent, pp] = utils.getParent(editor, p);\n        if (!parent) continue;\n        if (ListLogic.isListItem(parent)) {\n          !e.shiftKey\n            ? ListLogic.indentLi(editor, [parent, pp])\n            : ListLogic.liftLi(editor, [parent, pp]);\n        }\n      }\n      break;\n    }\n  }\n};\n","/* eslint-disable eqeqeq */\nimport { Node, Transforms, Editor } from \"slate\";\nimport { CET, EditorType } from \"../../common/Defines\";\nimport { utils } from \"../../common/utils\";\nimport { ListLogic } from \"../../comps/ListComp\";\nimport { TableLogic } from \"../../comps/Table\";\nimport { TdLogic } from \"../../comps/Td\";\n\nexport const handleRangeCollapsed = (e: any, editor: EditorType): void => {\n  const { selection } = editor;\n  if (!selection) return;\n\n  // 以下是没有选区的情况下的事件\n  const elementType = utils.getFirstAboveElementType(editor);\n\n  const getEditingTd = () => {\n    return TableLogic.getEditingTds(editor)?.[0];\n  };\n\n  // 如果默认事件没有被组件拦截掉，那么在这里重新定义拦截逻辑\n  switch (e.key) {\n    case \"Tab\": {\n      e.preventDefault();\n      if (CET.LIST_ITEM === elementType) {\n        e.shiftKey\n          ? ListLogic.shiftTabEvent(editor)\n          : ListLogic.tabEvent(editor);\n        break;\n      }\n      if (CET.TD === elementType) {\n        e.shiftKey\n          ? TableLogic.shiftTabEvent(editor)\n          : TableLogic.tabEvent(editor);\n        break;\n      }\n      // 如果是在其他元素上\n      !e.shiftKey && Transforms.insertText(editor, \"    \");\n      break;\n    }\n    case \"Escape\": {\n      const td = getEditingTd();\n      if (!td) break;\n      TdLogic.chooseTd(editor, td);\n      break;\n    }\n    case \"ArrowUp\": {\n      const td = getEditingTd();\n      if (td) {\n        const first = Node.child(td[0], 0);\n        const cursor = Editor.parent(editor, selection.anchor);\n        if (first == cursor[0]) {\n          TdLogic.findTargetTd(editor, td, \"up\");\n          Transforms.deselect(editor);\n          e.preventDefault();\n          return;\n        }\n        return;\n      }\n      return;\n    }\n    case \"ArrowDown\": {\n      const td = getEditingTd();\n      if (td) {\n        const last = Node.child(td[0], td[0].children.length - 1);\n        const cursor = Editor.parent(editor, selection.anchor);\n        if (last == cursor[0]) {\n          TdLogic.findTargetTd(editor, td, \"down\");\n          Transforms.deselect(editor);\n          e.preventDefault();\n          return;\n        }\n        return;\n      }\n      return;\n    }\n    case \"ArrowLeft\": {\n      const td = getEditingTd();\n      if (td && Editor.isStart(editor, selection.anchor, td[1])) {\n        TdLogic.findTargetTd(editor, td, \"left\");\n        Transforms.deselect(editor);\n        e.preventDefault();\n        return;\n      }\n      return;\n    }\n    case \"ArrowRight\": {\n      const td = getEditingTd();\n      if (td && Editor.isEnd(editor, selection.anchor, td[1])) {\n        TdLogic.findTargetTd(editor, td, \"right\");\n        Transforms.deselect(editor);\n        e.preventDefault();\n        return;\n      }\n      return;\n    }\n  }\n  return;\n};\n","export default \"data:image/jpeg;base64,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\"","/* eslint-disable eqeqeq */\nimport { Resizable } from \"re-resizable\";\nimport { useState, useEffect } from \"react\";\nimport { Transforms } from \"slate\";\nimport {\n  useSelected,\n  ReactEditor,\n  RenderElementProps,\n  useSlateStatic,\n} from \"slate-react\";\nimport testImg from \"../c.jpg\";\n\nexport const ImgComp: (props: RenderElementProps) => JSX.Element = ({\n  attributes,\n  children,\n  element,\n}) => {\n  const selected = useSelected();\n  const editor = useSlateStatic();\n  const [state, setState] = useState({\n    size: {\n      width: element.width || 100,\n      height: element.height || 100,\n    },\n    showTool: false,\n  });\n\n  const enableResize = () => {\n    return ReactEditor.isReadOnly(editor)\n      ? {\n          top: false,\n          right: false,\n          bottom: false,\n          left: false,\n          topRight: false,\n          bottomRight: false,\n          bottomLeft: false,\n          topLeft: false,\n        }\n      : {\n          top: true,\n          right: true,\n          bottom: true,\n          left: true,\n          topRight: true,\n          bottomRight: true,\n          bottomLeft: true,\n          topLeft: true,\n        };\n  };\n\n  useEffect(() => {\n    return () => {\n      window.onclick = () => {};\n    };\n  }, []);\n\n  const onResizeStop: ConstructorParameters<\n    typeof Resizable\n  >[0][\"onResizeStop\"] = (e, direction, ref, d) => {\n    const newWidth = state.size.width + d.width;\n    const newHeight = state.size.height + d.height;\n    setState((t) => ({\n      ...t,\n      size: {\n        width: newWidth,\n        height: newHeight,\n      },\n    }));\n    const path = ReactEditor.findPath(editor, element);\n    Transforms.setNodes(\n      editor,\n      {\n        children: [],\n        width: newWidth,\n        height: newHeight,\n      },\n      { at: path }\n    );\n  };\n\n  const toggleShowTool = () => {\n    if (state.showTool) return;\n    setState((t) => ({ ...t, showTool: true }));\n\n    setTimeout(() => {\n      window.onclick = (e: any) => {\n        if (e.path.findIndex((o: any) => o?.dataset?.cyimgcomptool == 1) != -1)\n          return;\n        else {\n          window.onclick = () => {};\n          setState((t) => ({ ...t, showTool: false }));\n        }\n      };\n    }, 0);\n  };\n\n  const showBigImg = () => {\n    window.open(element.url || testImg);\n  };\n\n  return (\n    <div\n      {...attributes}\n      contentEditable={false}\n      style={{\n        position: \"relative\",\n        display: \"inline-block\",\n        marginRight: 5,\n        marginLeft: 5,\n        verticalAlign: \"bottom\",\n        boxShadow: state.showTool || selected ? \"0 0 0 3px rgba(180,215,255,.7)\" : \"none\",\n      }}\n      onClick={toggleShowTool}\n      onDoubleClick={showBigImg}\n    >\n      <Resizable\n        enable={enableResize()}\n        style={{ display: \"inline-block\" }}\n        size={state.size}\n        onResizeStop={onResizeStop}\n      >\n        <img\n          width=\"100%\"\n          height=\"100%\"\n          alt=\"\"\n          src={element.url || testImg}\n        ></img>\n        {children}\n      </Resizable>\n    </div>\n  );\n};\n","/* eslint-disable eqeqeq */\n/* eslint-disable react-hooks/exhaustive-deps */\nimport { DisconnectOutlined, SelectOutlined } from \"@ant-design/icons\";\nimport { Button, Col, Form, Input, Popover, Row } from \"antd\";\nimport { useState } from \"react\";\nimport { Editor, Element, Transforms } from \"slate\";\nimport {\n  RenderElementProps,\n  ReactEditor,\n  useSlateStatic,\n  useReadOnly,\n} from \"slate-react\";\nimport { CET } from \"../common/Defines\";\n\nexport const LinkComp: (props: RenderElementProps) => JSX.Element = ({\n  attributes,\n  children,\n  element,\n}) => {\n  const editor = useSlateStatic();\n  const readOnly = useReadOnly();\n  const [content, setContent] = useState<string>();\n  const [url, setUrl] = useState<string>();\n\n  const visitLink = () => {\n    window.open(element.url);\n  };\n\n  const cancelLink = (e: any) => {\n    e.preventDefault();\n    ReactEditor.focus(editor);\n\n    const { selection } = editor;\n    if (!selection) return;\n\n    Transforms.unwrapNodes(editor, {\n      match(n) {\n        return Element.isElement(n) && n.type == CET.LINK;\n      },\n    });\n  };\n\n  const formItemStyle = { marginBottom: 6 };\n\n  const submitChange = () => {\n    ReactEditor.focus(editor);\n    const link = ReactEditor.toSlateNode(editor, attributes.ref.current);\n    const linkPath = ReactEditor.findPath(editor, link);\n    if (link && linkPath) {\n      Transforms.insertText(editor, content || \"link\", {\n        at: Editor.range(editor, linkPath),\n      });\n      Transforms.setNodes(editor, { url }, { at: linkPath });\n    }\n  };\n\n  const editPanel = (\n    <Form size=\"small\">\n      <Row gutter={8} style={{ flexDirection: \"column\", width: 300 }}>\n        <Col flex=\"1\">\n          <Form.Item label=\"操作\" style={formItemStyle}>\n            <Button size=\"small\" onClick={visitLink}>\n              <SelectOutlined title=\"访问链接\" /> 访问链接\n            </Button>\n            &nbsp;\n            <Button size=\"small\" onMouseDown={cancelLink}>\n              <DisconnectOutlined title=\"取消链接\" /> 取消链接\n            </Button>\n          </Form.Item>\n        </Col>\n        <Col flex=\"1\">\n          <Form.Item label=\"文字\" style={formItemStyle}>\n            <Input\n              value={content}\n              onChange={(el: any) => {\n                setContent(el.target.value);\n              }}\n            />\n          </Form.Item>\n        </Col>\n        <Col>\n          <Form.Item label=\"链接\" style={formItemStyle}>\n            <Input\n              value={url}\n              onChange={(el: any) => {\n                setUrl(el.target.value);\n              }}\n            />\n          </Form.Item>\n        </Col>\n        <Row justify=\"end\">\n          <Button\n            type=\"primary\"\n            style={{ width: 100, marginRight: 4 }}\n            onClick={submitChange}\n          >\n            确定\n          </Button>\n        </Row>\n      </Row>\n    </Form>\n  );\n\n  const initEditPanel = () => {\n    const linkWrapper = attributes.ref.current;\n    const link = linkWrapper.querySelector(\"a\");\n\n    if (!link) return;\n\n    setUrl(link.href);\n    setContent(link.innerText);\n  };\n\n  return (\n    <div {...attributes} style={{ display: \"inline\", position: \"relative\" }}>\n      <Popover\n        placement=\"right\"\n        content={editPanel}\n        trigger={readOnly ? [] : [\"hover\"]}\n      >\n        <a\n          href={element.url}\n          target=\"__blank\"\n          onMouseEnter={() => initEditPanel()}\n        >\n          {children}\n        </a>\n      </Popover>\n    </div>\n  );\n};\n","import {\n  EditorType,\n  CustomElement,\n  CustomText,\n  CET,\n  TextWrappers,\n} from \"../common/Defines\";\nimport { TD } from \"../comps/Td\";\nimport { Table } from \"../comps/Table\";\nimport { ImgComp } from \"../comps/ImgComp\";\nimport { LinkComp } from \"../comps/LinkComp\";\nimport { RenderElementProps } from \"slate-react\";\n\ndeclare module \"slate\" {\n  interface CustomTypes {\n    Editor: EditorType;\n    Element: CustomElement;\n    Text: CustomText;\n  }\n}\nexport const MyElements: (props: RenderElementProps) => JSX.Element = (\n  props\n) => {\n  const { attributes, children, element } = props;\n  const style: any = {};\n  if (TextWrappers.includes(element.type) && element.textAlign)\n    style.textAlign = element.textAlign;\n\n  switch (element.type) {\n    case CET.NUMBER_LIST:\n      return <ol {...attributes}>{children}</ol>;\n    case CET.NORMAL_LIST:\n      return <ul {...attributes}>{children}</ul>;\n    case CET.LIST_ITEM:\n      return (\n        <li {...attributes} style={{ color: element.liColor || \"unset\" }}>\n          {children}\n        </li>\n      );\n    case CET.DIV:\n      return (\n        <div {...attributes} style={style}>\n          {children}\n        </div>\n      );\n    case CET.H1:\n      return (\n        <h1 {...attributes} style={{ ...style }}>\n          {children}\n        </h1>\n      );\n    case CET.H2:\n      return (\n        <h2 {...attributes} style={{ ...style }}>\n          {children}\n        </h2>\n      );\n    case CET.H3:\n      return (\n        <h3 {...attributes} style={{ ...style }}>\n          {children}\n        </h3>\n      );\n    case CET.H4:\n      return (\n        <h4 {...attributes} style={{ ...style }}>\n          {children}\n        </h4>\n      );\n    case CET.IMG:\n      return <ImgComp {...props}>{children}</ImgComp>;\n    case CET.LINK:\n      return <LinkComp {...props}></LinkComp>;\n    case CET.TABLE:\n      return <Table {...props}></Table>;\n    case CET.TBODY:\n      return <tbody {...attributes}>{children}</tbody>;\n    case CET.TR:\n      const otherAttr: any = {};\n      if (element.shouldEmpty) {\n        otherAttr.contentEditable = false;\n      }\n      return (\n        <tr {...attributes} {...otherAttr}>\n          {element.shouldEmpty ? null : children}\n        </tr>\n      );\n    case CET.TD:\n      return <TD {...props}></TD>;\n    default:\n      return <div {...attributes}>{children}</div>;\n  }\n};\n","import { Marks, EditableProps } from \"../common/Defines\";\n\nexport const MyLeaf: NonNullable<EditableProps[\"renderLeaf\"]> = ({\n  attributes,\n  children,\n  leaf,\n}) => {\n  const style: any = {};\n  if (leaf[Marks.BOLD]) style.fontWeight = \"bold\";\n  if (leaf[Marks.ITALIC]) style.fontStyle = \"italic\";\n  if (leaf[Marks.FontSize]) style.fontSize = leaf.fontSize;\n  if (leaf[Marks.Underline] || leaf[Marks.LineThrough])\n    style.textDecoration = `${leaf[Marks.Underline] ? \"underline\" : \"\"} ${\n      leaf[Marks.LineThrough] ? \"line-through\" : \"\"\n    }`;\n  if (leaf[Marks.Color]) style.color = leaf[Marks.Color];\n  if (leaf[Marks.BGColor]) style.backgroundColor = leaf[Marks.BGColor];\n\n  return (\n    <span {...attributes} style={style}>\n      {children}\n    </span>\n  );\n};\n","/* eslint-disable react-hooks/exhaustive-deps */\n/* eslint-disable eqeqeq */\n/* eslint-disable @typescript-eslint/no-unused-vars */\n/* eslint-disable @typescript-eslint/ban-types */\nimport {\n  useCallback,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n  createContext,\n} from \"react\";\nimport { createEditor, Transforms, Editor, Operation, Selection } from \"slate\";\nimport { Slate, Editable, withReact } from \"slate-react\";\nimport { withHistory } from \"slate-history\";\nimport {\n  CET,\n  CustomElement,\n  EditableProps,\n  EditorCompShape,\n  Marks,\n  StateShape,\n} from \"./common/Defines\";\nimport { TableLogic } from \"./comps/Table\";\nimport { utils } from \"./common/utils\";\nimport { ToolBar } from \"./comps/ToolBar\";\nimport { TdLogic } from \"./comps/Td\";\nimport { withCyWrap } from \"./plugins/WithCyWrap\";\nimport { HandleKeyDownEvent } from \"./EventHandler/HandleKeyDownEvent/HandleKeyDownEvent\";\nimport { MyElements } from \"./RenderElements/MyElements\";\nimport { MyLeaf } from \"./RenderElements/RenderLeaf\";\nimport _ from \"lodash\";\nimport \"antd/dist/antd.css\"; // or 'antd/dist/antd.less'\nimport \"./RichEditor.css\";\nimport { htmlToSlate } from \"./common/htmlToSlate\";\n\ntype savedMarksShape =\n  | (Partial<\n      {\n        [key in Marks]: any;\n      }\n    > &\n      Partial<\n        {\n          [key in keyof CustomElement]: CustomElement[key];\n        }\n      > & {\n        [key: string]: any;\n      })\n  | null\n  | undefined;\n\nexport const EditorContext = createContext<{\n  savedMarks: savedMarksShape;\n  setSavedMarks: (marks: savedMarksShape) => void;\n  readOnly: boolean;\n  setReadOnly: (value: boolean) => void;\n}>({\n  savedMarks: null,\n  setSavedMarks: () => {},\n  readOnly: false,\n  setReadOnly: () => {},\n});\n\nconst EditorComp: EditorCompShape = () => {\n  /**\n   * 解决live refresh问题的链接\n   * https://github.com/ianstormtaylor/slate/issues/4081\n   */\n  const [editor] = useState(withCyWrap(withHistory(withReact(createEditor()))));\n  // const [editor] = useState(withCyWrap(withReact(createEditor())));\n  const [value, setValue] = useState<StateShape>(() => {\n    const content =\n      window.localStorage.getItem(\"savedContent\") ||\n      JSON.stringify([{ type: CET.DIV, children: [{ text: \"\" }] }]);\n    // return TableLogic.model || JSON.parse(content);\n    return JSON.parse(content);\n  });\n  const ref = useRef<{\n    preUndos: Operation[][];\n    preSelection: Selection | null;\n  }>({\n    preUndos: [],\n    preSelection: null,\n  });\n  const [savedMarks, setSavedMarks] = useState<savedMarksShape>();\n  useEffect(() => {\n    if (savedMarks != null) {\n      document.body.style.cursor = \"copy\";\n    } else {\n      document.body.style.cursor = \"auto\";\n    }\n  }, [savedMarks]);\n  const [readOnly, setReadOnly] = useState(false);\n\n  useEffect(() => {\n    // window.localStorage.removeItem(\"history\");\n    // setTimeout(() => {\n    //   unitTest(editor);\n    // }, 100);\n    // TableLogic.resetSelectedTds(editor);\n  }, []);\n\n  // useEffect(() => {\n  //   // console.log(ref.current.preUndos);\n  //   // console.log(editor.history.undos);\n  //   ref.current.preUndos = _.clone(editor.history.undos);\n  // }, [editor.history.undos.length]);\n\n  const renderElement: EditableProps[\"renderElement\"] = useCallback(\n    (props) => <MyElements {...props} editorRef={ref}></MyElements>,\n    []\n  );\n  const renderLeaf: EditableProps[\"renderLeaf\"] = useCallback((props) => {\n    return <MyLeaf {...props}></MyLeaf>;\n  }, []);\n  const MyToolBar = useMemo(() => {\n    return <ToolBar></ToolBar>;\n  }, []);\n\n  const handleSelect = () => {\n    // 处理格式刷逻辑\n    if (savedMarks != null) {\n      const hasSelectTd = TableLogic.getFirstSelectedTd(editor);\n      if (hasSelectTd) return;\n\n      const hasTextAlign = savedMarks[Marks.TextAlign];\n      const textWrapper = Editor.above(editor, {\n        mode: \"lowest\",\n        match(n) {\n          return utils.isTextWrapper(n);\n        },\n      });\n      if (!textWrapper) return;\n      for (const key of Object.values(Marks)) {\n        Editor.removeMark(editor, key);\n      }\n      if (hasTextAlign) {\n        Transforms.unsetNodes(editor, Marks.TextAlign, { at: textWrapper[1] });\n      }\n      for (const key in savedMarks) {\n        Editor.addMark(editor, key, savedMarks[key]);\n      }\n      if (hasTextAlign) {\n        Transforms.setNodes(\n          editor,\n          {\n            [Marks.TextAlign]: savedMarks[Marks.TextAlign],\n          },\n          { at: textWrapper[1] }\n        );\n      }\n      setSavedMarks(null);\n      document.body.style.cursor = \"auto\";\n      editor.selection &&\n        Transforms.select(editor, Editor.start(editor, editor.selection));\n    }\n  };\n  const handleFocus = () => {\n    ref.current.preSelection &&\n      Transforms.select(editor, ref.current.preSelection);\n  };\n  const handleBlur = () => {\n    ref.current.preSelection = editor.selection;\n  };\n  const handleMouseDown = (e: any) => {\n    // 取消所有表格的选中状态，因为表格部分已经阻止了自己的mousedown事件传递到父组件，所以只要能在这里触发的，都肯定不是在表格里\n    TdLogic.deselectAllTd(editor);\n  };\n  const handleKeyDown = (e: any) => HandleKeyDownEvent(e, editor);\n\n  return (\n    <div className=\"cyEditor\" style={{ position: \"relative\" }}>\n      <Slate\n        editor={editor}\n        value={value}\n        onChange={(value) => {\n          setValue(value);\n        }}\n      >\n        <EditorContext.Provider\n          value={{\n            savedMarks: savedMarks,\n            setSavedMarks: setSavedMarks,\n            readOnly,\n            setReadOnly,\n          }}\n        >\n          {MyToolBar}\n          <div\n            className=\"cyEditor__content\"\n            style={{\n              overflow: \"auto\",\n              height: window.screen.availHeight - 200,\n              border: \"1px solid\",\n              padding: 12,\n            }}\n          >\n            <Editable\n              renderElement={renderElement}\n              renderLeaf={renderLeaf}\n              autoFocus\n              readOnly={readOnly}\n              onCompositionStart={() => {\n                utils.removeRangeElement(editor);\n              }}\n              placeholder=\"welcome to cyEditor!\"\n              onKeyDown={handleKeyDown}\n              onMouseDown={handleMouseDown}\n              onDragStart={(e) => {\n                e.preventDefault();\n              }}\n              onBlur={handleBlur}\n              onFocus={handleFocus}\n              onSelect={handleSelect}\n            />\n          </div>\n        </EditorContext.Provider>\n      </Slate>\n    </div>\n  );\n};\n\nexport default EditorComp;\n","/* eslint-disable eqeqeq */\n/* eslint-disable @typescript-eslint/no-unused-vars */\nimport _ from \"lodash\";\nimport {\n  Editor,\n  Range,\n  Element,\n  Text,\n  Transforms,\n  NodeEntry,\n  Path,\n  Descendant,\n} from \"slate\";\nimport { CET, CustomElement, EditorType, InLineTypes } from \"../common/Defines\";\nimport { utils } from \"../common/utils\";\nimport { ListLogic } from \"../comps/ListComp\";\nimport { TableLogic } from \"../comps/Table\";\nimport {\n  getCopyedCells,\n  getEditingTdsPath,\n  getStrPathSetOfSelectedTds,\n  setCopyedCells,\n  setCopyedContent,\n  setCopyedMaxRowAndCol,\n} from \"../common/globalStore\";\nimport { htmlToSlate } from \"../common/htmlToSlate\";\nimport { jsx } from \"slate-hyperscript\";\n\nexport const withCyWrap = (editor: EditorType) => {\n  const {\n    deleteForward,\n    deleteBackward,\n    deleteFragment,\n    getFragment,\n    insertFragment,\n    insertText,\n    insertData,\n    insertBreak,\n    isInline,\n    isVoid,\n    normalizeNode,\n    setFragmentData,\n    apply,\n    redo,\n    undo,\n  } = editor;\n\n  // editor.undo = () => {\n  //   undo();\n  // };\n\n  editor.apply = (e) => {\n    // const array = JSON.parse(window.localStorage.getItem(\"history\") || \"[]\");\n    try {\n      apply(e);\n      // window.localStorage.setItem(\"history\", JSON.stringify(array));\n    } catch (error) {\n      console.warn(error);\n    }\n  };\n\n  editor.insertBreak = () => {\n    if (!editor.selection) return;\n    if (Range.isExpanded(editor.selection)) {\n      utils.removeRangeElement(editor);\n    } else {\n      const textWrapper = utils.getParent(editor, editor.selection.anchor.path);\n      if (!textWrapper[0]) return;\n      const twParent = Editor.parent(editor, textWrapper[1]);\n\n      const li = ListLogic.isListItem(twParent[0]) && twParent;\n      if (li && Editor.string(editor, li[1], { voids: true }) === \"\") {\n        Transforms.liftNodes(editor, { at: li[1] });\n        return;\n      }\n    }\n    insertBreak();\n  };\n\n  editor.deleteFragment = (direction) => {\n    utils.removeRangeElement(editor);\n    deleteFragment(direction);\n  };\n\n  editor.deleteForward = (unit) => {\n    if (editor.selection && Range.isCollapsed(editor.selection)) {\n      normalizeList();\n\n      const textWrapper = Editor.above(editor, {\n        mode: \"lowest\",\n        match(n) {\n          return utils.isTextWrapper(n);\n        },\n      });\n      if (!textWrapper) return;\n      const twParent = Editor.parent(editor, textWrapper[1]);\n\n      const td = TableLogic.isTd(twParent[0]) && twParent;\n\n      // 如果在td的最后一个文本域的最后一个位置，那么阻止默认行为\n      if (td && Editor.isEnd(editor, editor.selection.anchor, td[1])) return;\n\n      // 如果光标的下一个位置是表格的第一个位置\n      const after = Editor.after(editor, editor.selection.anchor);\n      const nextTable = Editor.above(editor, {\n        at: after,\n        match(n) {\n          return TableLogic.isTable(n);\n        },\n      });\n      if (nextTable && after && Editor.isStart(editor, after, nextTable[1])) {\n        return;\n      }\n\n      if (Editor.string(editor, textWrapper[1], { voids: true }) === \"\") {\n        Transforms.removeNodes(editor, {\n          at: textWrapper[1],\n        });\n        return;\n      }\n\n      deleteForward(unit);\n    }\n  };\n\n  editor.deleteBackward = (unit) => {\n    if (editor.selection && Range.isCollapsed(editor.selection)) {\n      normalizeList();\n\n      const textWrapper = Editor.above(editor, {\n        mode: \"lowest\",\n        match(n) {\n          return utils.isTextWrapper(n);\n        },\n      });\n      if (!textWrapper) return;\n\n      const twParent = Editor.parent(editor, textWrapper[1]);\n\n      const td = TableLogic.isTd(twParent[0]) && twParent;\n      const li = ListLogic.isListItem(twParent[0]) && twParent;\n\n      // 如果在td的第一个文本域的第一个位置，那么阻止默认行为\n      if (td && Editor.isStart(editor, editor.selection.anchor, td[1])) return;\n\n      // 如果光标处于列表里\n      if (li && Editor.isStart(editor, editor.selection.anchor, li[1])) {\n        Transforms.liftNodes(editor, { at: li[1] });\n        return;\n      }\n\n      // 如果光标的前一个位置刚好进入表格，那么阻止执行\n      const before = Editor.before(editor, editor.selection.anchor);\n      const preTable = Editor.above(editor, {\n        at: before,\n        match(n) {\n          return TableLogic.isTable(n);\n        },\n      });\n      if (preTable && before && Editor.isEnd(editor, before, preTable[1])) {\n        return;\n      }\n\n      if (Editor.string(editor, textWrapper[1], { voids: true }) === \"\") {\n        Transforms.removeNodes(editor, {\n          at: textWrapper[1],\n        });\n        return;\n      }\n\n      deleteBackward(unit);\n    }\n  };\n\n  editor.insertText = (e) => {\n    if (editor.selection && Range.isExpanded(editor.selection)) {\n      utils.removeRangeElement(editor);\n    }\n    insertText(e);\n  };\n\n  // 在本编辑器复制的时候触发\n  // dataTransfer 说明：https://developer.mozilla.org/zh-CN/docs/Web/API/DataTransfer\n  editor.getFragment = () => {\n    setCopyedCells(null);\n    setCopyedMaxRowAndCol({ copyedAreaHeight: 0, copyedAreaWidth: 0 });\n    setCopyedContent(getFragment());\n    // console.log(\"getFragment\", getFragment());\n    // return [\n    //   {\n    //     type: CET.DIV,\n    //     children: [{ text: \"chenyu paste text\" }],\n    //   },\n    // ];\n    return getFragment();\n  };\n\n  // 在粘贴的时候触发\n  editor.insertFragment = (fragment) => {\n    utils.removeRangeElement(editor);\n    Transforms.insertNodes(editor, fragment);\n  };\n\n  // 粘贴的时候首先触发的方法，在这里可以将传入的内容进行个性化处理，然后生成新的dataTransfer传递给slate\n  editor.insertData = (e) => {\n    // console.log(\"insertdata\");\n    // 解码application/x-slate-fragment内容\n    // console.log(\n    //   utils.decodeContentToSlateData(e.getData(\"application/x-slate-fragment\"))\n    // );\n    // newTransfer.setData(\"text/plain\", \"plan text\");\n    const tds = getCopyedCells();\n    if (tds) {\n      const [table] = Editor.nodes(editor, {\n        at: tds[0][1],\n        mode: \"lowest\",\n        match(n) {\n          return TableLogic.isTable(n);\n        },\n      });\n      if (table) {\n        const newTransfer = new DataTransfer();\n        newTransfer.setData(\n          \"application/x-slate-fragment\",\n          // 编码内容\n          utils.encodeSlateContent([table[0] as Descendant])\n        );\n        insertData(newTransfer);\n        return;\n      }\n    } else if (e.types.includes(\"application/x-slate-fragment\")) {\n      insertData(e);\n    } else if (e.types.includes(\"text/plain\")) {\n      const newTransfer = new DataTransfer();\n      const content = htmlToSlate(e.getData(\"text/plain\"));\n      console.log(content);\n      newTransfer.setData(\n        \"application/x-slate-fragment\",\n        // 编码内容\n        utils.encodeSlateContent(content)\n      );\n      insertData(newTransfer);\n    }\n  };\n\n  const normalizeList = _.debounce(() => {\n    const afterList = Editor.next(editor, {\n      match(n) {\n        return ListLogic.isOrderList(n);\n      },\n    });\n    if (afterList) editor.normalizeNode(afterList);\n    const beforeList = Editor.previous(editor, {\n      match(n) {\n        return ListLogic.isOrderList(n);\n      },\n    });\n    if (beforeList) editor.normalizeNode(beforeList);\n  }, 0);\n\n  editor.isInline = (node) => {\n    if ([CET.IMG, CET.LINK].includes(node.type)) {\n      return true;\n    }\n    return isInline(node);\n  };\n  editor.isVoid = (node) => {\n    if ([CET.IMG].includes(node.type)) {\n      return true;\n    }\n    return isVoid(node);\n  };\n\n  const normalizeEditor = (nodeEntry: NodeEntry) => {\n    const [node, path] = nodeEntry;\n\n    // 如果没有子元素，那么强行添加一个\n    if (editor.children.length === 0) {\n      Transforms.insertNodes(editor, {\n        type: CET.DIV,\n        children: [{ text: \"\" }],\n      });\n      return;\n    }\n\n    // 如果一个块级元素出现在textWrapper里，那么直接删除\n    if (Element.isElement(node) && Editor.isBlock(editor, node)) {\n      const [parent] = utils.getParent(editor, path);\n      if (utils.isTextWrapper(parent)) {\n        Transforms.removeNodes(editor, { at: path });\n        return;\n      }\n    }\n\n    // inline元素和void元素的前后都必须有文本节点\n    if (Element.isElement(node) && InLineTypes.includes(node.type)) {\n      const prePath = utils.getPath(path, \"pre\");\n      const [preNode] = utils.getNodeByPath(editor, prePath);\n      if (!Text.isText(preNode)) {\n        Transforms.insertNodes(editor, { text: \"\" }, { at: prePath });\n        return;\n      }\n\n      const nextPath = utils.getPath(path, \"next\");\n      const [nextNode] = utils.getNodeByPath(editor, nextPath);\n      if (!Text.isText(nextNode)) {\n        Transforms.insertNodes(editor, { text: \"\" }, { at: nextPath });\n        return;\n      }\n    }\n\n    if (Element.isElement(node) && node.type === CET.LINK) {\n      if (Editor.string(editor, path, { voids: true }) === \"\") {\n        Transforms.removeNodes(editor, { at: path });\n        return;\n      }\n    }\n\n    if (TableLogic.normalizeTable(editor, nodeEntry)) return;\n    if (ListLogic.normalizeList(editor, nodeEntry)) return;\n\n    normalizeNode(nodeEntry);\n  };\n\n  editor.normalizeNode = normalizeEditor;\n\n  return editor;\n};\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport Editor from \"./components/RichEditor/RichEditor\";\n\nReactDOM.render(\n  <Editor />,\n  document.getElementById('root')\n);"],"sourceRoot":""}